<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASG Empire - Innovaci√≥n y Futuro en Cada Producto</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins (headings) & Inter (body) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // Expose Firebase modules globally for use in the main script
        window.firebase = { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp };
    </script>
    <style>
        /* Base Styles - Modern, Dark, and Clean */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Main dark background */
            color: #e2e8f0; /* Light text */
            line-height: 1.6;
            scroll-behavior: smooth;
            overflow-x: hidden; /* Prevents horizontal scrolling */
        }

        /* General class to hide elements */
        .hidden {
            display: none !important;
        }

        /* General Container Style */
        .container {
            max-width: 1300px;
            margin-left: auto;
            margin-right: auto;
            padding: 2rem;
            transition: margin-left 0.3s ease, padding-left 0.3s ease; /* Smooth transition for margin and padding */
        }

        /* Header Style */
        .header {
            background-color: #2d3748; /* Dark header */
            color: #e2e8f0;
            padding: 1rem 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1.2rem; /* Adjusted for consistency */
            display: flex;
            flex-wrap: wrap; /* Allows elements to wrap on small screens */
            justify-content: space-between; /* Distributes elements */
            align-items: center;
            gap: 1rem; /* Space between header elements */
        }
        .header .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: -0.03em;
            color: #6366f1; /* Primary blue-violet */
            cursor: pointer;
            transition: color 0.3s ease;
            flex-shrink: 0;
        }
        .header .logo:hover {
            color: #4f46e5;
        }
        .header .header-nav {
            display: flex;
            gap: 1rem;
        }
        .header .nav-link {
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-weight: 500;
            color: #cbd5e0; /* Lighter navigation text */
        }
        .header .nav-link:hover {
            background-color: #4a5568; /* Darker background on hover */
            color: #6366f1;
        }
        .header .cart-icon-btn {
            background: none;
            border: none;
            color: #6366f1; /* Primary blue-violet */
            font-size: 1.6rem;
            cursor: pointer;
            position: relative;
            padding: 0.5rem;
            transition: color 0.3s ease, transform 0.2s ease;
        }
        .header .cart-icon-btn:hover {
            color: #4f46e5;
            transform: scale(1.1);
        }
        .header .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ef4444; /* Red badge */
            color: white;
            border-radius: 50%;
            padding: 0.2em 0.5em;
            font-size: 0.7rem;
            font-weight: 700;
            line-height: 1;
            transform: translate(30%, -30%);
            min-width: 1.5em;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Search bar specific styles */
        .header-search-container {
            display: flex; /* Always display */
            flex-grow: 1; /* Allow it to grow */
            max-width: 400px; /* Max width for desktop */
        }
        .search-input {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem 0 0 0.5rem;
            background-color: #1a202c;
            color: #e2e8f0;
            border: 1px solid #4a5568;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .search-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.4);
        }
        .search-btn {
            padding: 0.5rem 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            background-color: #6366f1;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .search-btn:hover {
            background-color: #4f46e5;
        }


        /* Text Shadow Style */
        .text-shadow-lg {
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.6); /* Darker shadow for dark theme */
        }

        /* Section Heading */
        .section-heading {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            color: #e2e8f0; /* Light text */
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
        }
        .section-heading::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background-color: #6366f1; /* Primary blue-violet */
            margin: 1rem auto 0;
            border-radius: 2px;
        }

        /* General Buttons */
        .btn {
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: 0.6rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; /* Added box-shadow */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Base shadow */
        }
        .btn:hover {
            transform: translateY(-3px); /* Lift effect */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* Larger shadow on hover */
        }
        .btn-primary {
            background-color: #6366f1; /* Primary blue-violet */
            color: white;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
        }
        .btn-secondary {
            background-color: #4a5568; /* Dark background for secondary button */
            color: #e2e8f0; /* Light text */
        }
        .btn-secondary:hover {
            background-color: #6366f1; /* Hover background with primary color */
            color: white;
        }
        .btn-icon {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #a0aec0;
            padding: 0.6rem;
            border-radius: 0.5rem;
            transition: color 0.2s ease, transform 0.2s ease, background-color 0.2s ease, box-shadow 0.3s ease; /* Added box-shadow */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Base shadow for icons */
        }
        .btn-icon:hover {
            color: #e2e8f0;
            background-color: #4a5568;
            transform: translateY(-2px); /* Lift effect */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Larger shadow on hover */
        }


        /* Feature Cards */
        .feature-card {
            background-color: #2d3748; /* Dark background for cards */
            padding: 2.5rem;
            border-radius: 1.2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* More pronounced shadow */
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #4a5568; /* Darker border */
        }
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25);
        }
        .feature-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1.5rem;
            color: #6366f1; /* Primary blue-violet */
        }
        .feature-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: #e2e8f0; /* Light text */
            margin-bottom: 0.8rem;
        }
        .feature-description {
            color: #cbd5e0; /* Lighter text */
            font-size: 1rem;
        }

        /* Product Cards - General */
        .product-card {
            background-color: #2d3748; /* Dark background for product cards */
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 1px solid #4a5568;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 420px; /* Fixed height for consistent card size */
            cursor: pointer; /* Indicate clickable */
            max-width: 300px; /* Limit individual card width */
            margin-left: auto; /* Center individual card if it's smaller than grid cell */
            margin-right: auto; /* Center individual card if it's smaller than grid cell */
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
            border-color: #6366f1;
        }
        .product-image-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 75%; /* Aspect ratio 4:3 */
            margin-bottom: 0.8rem;
            border-radius: 0.6rem;
            overflow: hidden;
            pointer-events: none; /* Prevent click on image wrapper itself */
        }
        .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            pointer-events: none; /* Prevent click on image itself */
        }
        .product-card:hover .product-image {
            transform: scale(1.03);
        }
        .wishlist-icon {
            position: absolute;
            top: 0.6rem;
            right: 0.6rem;
            background-color: rgba(45, 55, 72, 0.8);
            border-radius: 50%;
            padding: 0.5rem;
            font-size: 1.1rem;
            color: #a0aec0;
            cursor: pointer;
            transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            z-index: 5;
            pointer-events: all; /* Allow clicks on wishlist icon */
        }
        .wishlist-icon.active {
            color: #ef4444;
            background-color: rgba(239, 68, 68, 0.2);
            transform: scale(1.05);
        }
        .wishlist-icon:hover {
            transform: scale(1.1);
        }
        .product-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 0.4rem;
            line-height: 1.3;
            min-height: 3.9em; /* Ensure consistent height for 3 lines of text */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            pointer-events: none; /* Prevent click on title itself */
        }
        .product-price-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 0.6rem;
            pointer-events: none; /* Prevent click on price container */
        }
        .product-current-price {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6366f1;
        }
        .product-old-price {
            font-size: 0.8rem;
            color: #a0aec0;
            text-decoration: line-through;
            margin-right: 0.4rem;
        }
        .product-discount-percentage {
            font-size: 0.8rem;
            font-weight: 600;
            color: #ef4444;
        }
        .product-price-info {
            display: flex;
            align-items: baseline;
            gap: 0.4rem;
        }
        .product-price-note {
            font-size: 0.7rem;
            color: #a0aec0;
            margin-top: 0.1rem;
        }
        .product-review-snippet {
            font-size: 0.8rem;
            color: #cbd5e0;
            margin-bottom: 0.8rem;
            max-height: 2.8em;
            -webkit-line-clamp: 2;
            pointer-events: none; /* Prevent click on snippet */
        }
        .product-actions-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
            margin-top: auto; /* Pushes buttons to the bottom */
        }
        .add-to-cart-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            width: 100%;
            pointer-events: all; /* Allow clicks on add to cart button */
        }
        .add-to-cart-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }


        /* Reusing carousel navigation styles */
        .carousel-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 0.8rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease;
            font-size: 1.2rem;
        }
        .carousel-nav-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        .carousel-nav-btn.left { left: 1rem; }
        .carousel-nav-btn.right { right: 1rem; }
        .carousel-dots {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.6rem;
            z-index: 10;
        }
        .carousel-dot {
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .carousel-dot.active {
            background: white;
            transform: scale(1.1);
        }

        /* New Section: Exclusive Advantages */
        .advantages-section {
            padding: 6rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        .advantages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }
        .advantage-card {
            background-color: #2d3748;
            padding: 2.5rem;
            border-radius: 1.2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 1px solid #4a5568;
        }
        .advantage-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25);
            border-color: #6366f1;
        }
        .advantage-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            color: #4facfe;
        }
        .advantage-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 0.8rem;
        }
        .advantage-description {
            color: #cbd5e0;
            font-size: 1rem;
        }


        /* FAQ Section */
        .faq-item {
            background-color: #2d3748;
            padding: 1.5rem 2rem;
            border-radius: 0.8rem;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            border: 1px solid #4a5568;
            transition: all 0.3s ease;
        }
        .faq-item:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border-color: #6366f1;
        }
        .faq-question {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #e2e8f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }
        .faq-answer {
            color: #cbd5e0;
            margin-top: 1rem;
            display: none;
            font-size: 0.95rem;
            line-height: 1.6;
            padding-top: 0.8rem;
            border-top: 1px dashed #4a5568;
        }
        .faq-answer.active {
            display: block;
        }
        .faq-toggle-icon {
            transition: transform 0.3s ease;
            color: #6366f1;
            font-size: 1.3rem;
        }
        .faq-toggle-icon.rotated {
            transform: rotate(180deg);
        }

        /* Footer */
        footer {
            background-color: #0d121c;
            color: white;
            padding: 3rem 2rem;
            border-top-left-radius: 1.5rem;
            border-top-right-radius: 1.5rem;
            margin-top: 4rem;
            text-align: center;
            box-shadow: 0 -8px 20px rgba(0, 0, 0, 0.3);
        }
        footer .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            color: #6366f1;
        }
        footer .footer-links a {
            color: #a0aec0;
            text-decoration: none;
            transition: color 0.3s ease;
            margin: 0 0.8rem;
            font-weight: 500;
        }
        footer .footer-links a:hover {
            color: #6366f1;
        }
        footer .social-icons a {
            color: white;
            font-size: 1.5rem;
            margin: 0 0.6rem;
            transition: color 0.3s ease, transform 0.2s ease;
        }
        footer .social-icons a:hover {
            color: #6366f1;
            transform: translateY(-3px);
        }

        /* Modal Styles - Centered and Improved */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: #2d3748;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 90%;
            text-align: left;
            transform: translateY(-30px) scale(0.9);
            transition: transform 0.4s ease-in-out, background-color 0.4s ease, box-shadow 0.4s ease;
            position: relative;
            border: 1px solid #4a5568;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0) scale(1);
        }
        .modal-content h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            color: #e2e8f0;
            text-align: center;
        }
        .modal-content p.modal-description {
            color: #cbd5e0;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }
        .modal-form-group {
            margin-bottom: 1.2rem;
        }
        .modal-form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #cbd5e0;
            font-size: 0.95rem;
        }
        .modal-form-group input, .modal-form-group textarea, .modal-form-group select {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #4a5568;
            border-radius: 0.6rem;
            font-size: 0.95rem;
            background-color: #1a202c;
            color: #e2e8f0;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .modal-form-group input:focus, .modal-form-group textarea:focus, .modal-form-group select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.4);
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 1.8rem;
            gap: 1rem;
        }
        .modal-buttons .btn {
            padding: 0.8rem 1.8rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.6rem;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .modal-buttons .btn-primary {
            background-color: #6366f1;
            color: white;
        }
        .modal-buttons .btn-primary:hover {
            background-color: #4f46e5;
            transform: translateY(-2px);
        }
        .modal-buttons .btn-secondary {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        .modal-buttons .btn-secondary:hover {
            background-color: #6366f1;
            color: white;
            transform: translateY(-2px);
        }
        .modal-close-btn {
            position: absolute;
            top: 1.2rem;
            right: 1.2rem;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #a0aec0;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .modal-close-btn:hover {
            color: #e2e8f0;
            transform: rotate(90deg);
        }

        /* Cart Modal Specifics */
        #cartModal .modal-content, #itemAddedModal .modal-content {
            max-width: 600px;
        }
        /* Specific adjustment for Purchase Confirmation modal */
        #purchaseConfirmModal .modal-content {
            max-width: 700px;
            padding: 1.8rem;
        }
        #purchaseConfirmModal .modal-form-group {
            margin-bottom: 0.8rem;
        }
        /* Warning message styles */
        #purchaseConfirmModal .warning-message {
            color: #f6ad55;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Product Detail Modal Styles */
        #productDetailModal .modal-content {
            max-width: 900px;
            width: 90%;
            height: auto;
            max-height: 90%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
        }

        #productDetailModal .product-detail-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        @media (min-width: 768px) {
            #productDetailModal .product-detail-grid {
                grid-template-columns: 1fr 1.5fr;
            }
            #productDetailModal .product-detail-left-column {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        }

        #productDetailModal .product-detail-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        #productDetailModal .product-detail-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        #productDetailModal .product-detail-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            font-weight: 800;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }
        /* Updated styles for product detail price */
        #productDetailModal .product-detail-price-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1rem;
        }
        #productDetailModal .product-detail-current-price {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #6366f1;
        }
        #productDetailModal .product-detail-old-price {
            font-size: 1.2rem;
            color: #a0aec0;
            text-decoration: line-through;
            margin-right: 0.5rem;
        }
        #productDetailModal .product-detail-discount-percentage {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ef4444;
        }
        #productDetailModal .product-detail-price-info {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }
        #productDetailModal .product-detail-price-note {
            font-size: 0.85rem;
            color: #a0aec0;
            margin-top: 0.5rem;
        }

        #productDetailModal .product-detail-description {
            color: #cbd5e0;
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        #productDetailModal .product-detail-specs ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.8rem;
        }
        #productDetailModal .product-detail-specs li {
            background-color: #1a202c;
            padding: 0.8rem 1rem;
            border-radius: 0.6rem;
            border: 1px solid #4a5568;
            font-size: 0.9rem;
            color: #a0aec0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #productDetailModal .product-detail-specs li i {
            color: #6366f1;
        }

        /* Comments Section Styles */
        .comments-section {
            background-color: #1a202c;
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid #4a5568;
            margin-top: 2rem;
        }
        .comments-section h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .comments-list {
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .comment-item {
            background-color: #2d3748;
            padding: 1rem;
            border-radius: 0.8rem;
            margin-bottom: 1rem;
            border: 1px solid #4a5568;
        }
        .comment-item strong {
            color: #6366f1;
            font-weight: 600;
        }
        .comment-item p {
            color: #cbd5e0;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .add-comment-form {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px dashed #4a5568;
        }
        .add-comment-form .modal-form-group {
            margin-bottom: 1rem;
        }
        .add-comment-form .btn-primary {
            width: 100%;
        }

        .cart-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            background-color: #1a202c;
            border-radius: 0.8rem;
            border: 1px solid #4a5568;
        }
        .cart-item-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 0.5rem;
            margin-right: 1rem;
        }
        .cart-item-details {
            flex-grow: 1;
        }
        .cart-item-details h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.2rem;
        }
        .cart-item-details p {
            font-size: 0.85rem;
            color: #cbd5e0;
        }
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .cart-item-actions .quantity-input {
            background-color: #2d3748;
            color: #e2e8f0;
            border: 1px solid #4a5568;
            border-radius: 0.4rem;
            width: 50px;
            text-align: center;
            padding: 0.4rem 0.2rem;
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .cart-item-actions .quantity-input::-webkit-inner-spin-button,
        .cart-item-actions .quantity-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .cart-item-actions .quantity-btn {
            background-color: #4a5568;
            color: #e2e8f0;
            padding: 0.4rem 0.7rem;
            border-radius: 0.4rem;
            font-size: 0.85rem;
            transition: background-color 0.2s;
            cursor: pointer;
            border: none;
        }
        .cart-item-actions .quantity-btn:hover {
            background-color: #6366f1;
        }

        .cart-item-actions .remove-from-cart-btn {
            background-color: #ef4444;
            color: white;
            padding: 0.4rem 0.7rem;
            border-radius: 0.4rem;
            font-size: 0.85rem;
            transition: background-color 0.2s;
        }
        .cart-item-actions .remove-from-cart-btn:hover {
            background-color: #dc2626;
        }
        .cart-total {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #e2e8f0;
            text-align: right;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px dashed #4a5568;
        }
        .empty-cart-message {
            text-align: center;
            color: #a0aec0;
            padding: 1.5rem;
            font-size: 1rem;
        }

        /* Item Added Confirmation Modal */
        #itemAddedModal .modal-content {
            text-align: center;
            padding: 2rem;
        }
        #itemAddedModal .modal-content h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        #itemAddedModal .modal-content p {
            font-size: 1rem;
            color: #cbd5e0;
            margin-bottom: 1.5rem;
        }
        #itemAddedModal .modal-content .modal-buttons {
            justify-content: center;
        }

        /* Product Image Carousel Styles in Modal */
        .product-image-carousel {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 75%;
            overflow: hidden;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            background-color: #1a202c;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        .product-image-carousel .carousel-slides-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .product-image-carousel .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .product-image-carousel .carousel-slide.active {
            opacity: 1;
        }
        .product-image-carousel .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .product-image-carousel .carousel-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0.8rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease;
        }
        .product-image-carousel .carousel-nav-btn:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        .product-image-carousel .carousel-nav-btn.left { left: 0.8rem; }
        .product-image-carousel .carousel-nav-btn.right { right: 0.8rem; }
        .product-image-carousel .carousel-dots {
            position: absolute;
            bottom: 0.8rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        .product-image-carousel .carousel-dot {
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .product-image-carousel .carousel-dot.active {
            background: white;
            transform: scale(1.2);
        }

        /* Quantity Selector Specific Styles */
        .quantity-selector-group {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px dashed #4a5568;
        }
        .quantity-selector-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #cbd5e0;
        }
        .quantity-selector-group input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .quantity-selector-group input[type="number"]::-webkit-inner-spin-button,
        .quantity-selector-group input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .quantity-selector-group .btn-icon {
            font-size: 1.5rem;
            padding: 0.3rem;
        }

        /* Wishlist Sidebar Specific Styles */
        #wishlistSidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 16rem;
            background-color: #2d3748;
            padding: 1rem;
            padding-top: 6rem;
            border-right: 1px solid #4a5568;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100vh;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        #wishlistSidebar.show-sidebar {
            transform: translateX(0);
        }
        #wishlistSidebar h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 1rem;
            text-align: center;
        }
        #wishlistSidebarItems {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        #wishlistSidebar .wishlist-item-sidebar {
            display: flex;
            align-items: center;
            padding: 0.6rem;
            background-color: #1a202c;
            border-radius: 0.6rem;
            margin-bottom: 0.5rem;
            border: 1px solid #4a5568;
            gap: 0.5rem;
        }
        #wishlistSidebar .wishlist-item-sidebar img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 0.4rem;
            flex-shrink: 0;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #e2e8f0;
            line-height: 1.2;
            margin-bottom: 0.2rem;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-info p {
            font-size: 0.75rem;
            color: #cbd5e0;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-actions {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            flex-shrink: 0;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-actions .btn {
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            border-radius: 0.4rem;
            box-shadow: none;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-actions .btn-primary {
            background-color: #6366f1;
            color: white;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-actions .btn-primary:hover {
            background-color: #4f46e5;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-actions .btn-secondary {
            background-color: #ef4444;
            color: white;
        }
        #wishlistSidebar .wishlist-item-sidebar .item-actions .btn-secondary:hover {
            background-color: #dc2626;
        }

        /* Wishlist Toggle Button */
        #wishlistToggleButton {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%) translateX(0);
            width: 30px;
            height: 60px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            z-index: 101;
            transition: transform 0.3s ease-in-out, background-color 0.3s ease;
        }
        #wishlistToggleButton.shifted {
            transform: translateY(-50%) translateX(16rem);
        }
        #wishlistToggleButton:hover {
            background-color: #4f46e5;
        }
        #wishlistToggleButton i {
            transition: transform 0.3s ease-in-out;
        }
        #wishlistToggleButton i.rotated {
            transform: rotate(180deg);
        }


        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .container.with-sidebar {
                margin-left: 16rem;
                padding-left: 2rem;
            }
            #wishlistSidebar {
                display: flex;
            }
            .product-carousel-container .carousel-slide {
                width: 33.33%;
            }
        }

        @media (min-width: 1024px) {
            .product-carousel-container .carousel-slide {
                width: 25%;
            }
        }

        @media (max-width: 767px) {
            .header {
                flex-direction: column;
                align-items: center;
                padding: 0.8rem 1rem;
            }
            .header .logo {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            .header .header-search-container {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .header .header-nav {
                width: 100%;
                justify-content: center;
                margin-bottom: 0.5rem;
                gap: 0.6rem;
            }
            .header .cart-icon-btn {
                font-size: 1.4rem;
                margin-top: 0.5rem;
            }
            .header .nav-link {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            .section-heading {
                font-size: 2.2rem;
            }
            .feature-card {
                padding: 2rem;
            }
            .feature-title {
                font-size: 1.4rem;
            }
            .product-card {
                padding: 1rem;
                height: auto; /* Allow height to adjust on mobile */
                min-height: 360px;
            }
            .product-title {
                font-size: 1.1rem;
            }
            .product-current-price {
                font-size: 1rem;
            }
            .product-old-price, .product-discount-percentage {
                font-size: 0.75rem;
            }
            .product-review-snippet {
                font-size: 0.75rem;
            }
            .add-to-cart-btn {
                font-size: 0.85rem;
                padding: 0.6rem 1.2rem;
            }
            .upcoming-sales-carousel {
                height: 300px;
            }
            .upcoming-sale-title {
                font-size: 2rem;
            }
            .upcoming-sale-description {
                font-size: 1rem;
            }
            .upcoming-sale-content {
                padding: 1.5rem 2rem;
            }
            .faq-item {
                padding: 1.2rem 1.5rem;
            }
            .faq-question {
                font-size: 1rem;
            }
            .modal-content {
                padding: 1.8rem;
            }
            #productDetailModal .modal-content {
                padding: 1.5rem;
                max-width: 95%;
                height: 95%;
            }
            #productDetailModal .product-detail-title {
                font-size: 1.8rem;
            }
            #productDetailModal .product-detail-current-price {
                font-size: 1.5rem;
            }
            #productDetailModal .product-detail-old-price, #productDetailModal .product-detail-discount-percentage {
                font-size: 1rem;
            }
            #productDetailModal .product-detail-description {
                font-size: 0.9rem;
            }
            #productDetailModal .product-detail-specs li {
                font-size: 0.8rem;
            }
            .comments-section h4 {
                font-size: 1.2rem;
            }
            .modal-content h3 {
                font-size: 1.6rem;
            }
            .modal-buttons {
                flex-direction: column;
                gap: 0.8rem;
            }
            .modal-buttons .btn {
                width: 100%;
            }

            /* Mobile specific for wishlist sidebar */
            #wishlistSidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                padding-top: 4rem;
                background-color: rgba(26, 32, 44, 0.95);
                backdrop-filter: blur(8px);
                z-index: 1500;
                transform: translateX(100%);
                transition: transform 0.4s ease-in-out;
            }
            #wishlistSidebar.show-sidebar {
                transform: translateX(0);
            }
            #wishlistToggleButton {
                display: none;
            }
            .container.with-sidebar {
                margin-left: auto;
                padding-left: 2rem;
            }
            /* Product carousel on mobile */
            .product-carousel-container {
                height: 350px;
            }
            .product-carousel-container .carousel-slide {
                width: 100%;
                padding: 0.5rem;
            }
            .product-card-carousel {
                width: 95%;
                padding: 0.8rem;
                min-height: 340px;
            }

            /* Upcoming Sales Carousel on Mobile */
            .upcoming-sales-carousel {
                height: 300px;
                border-radius: 1rem;
            }
            .upcoming-sale-slide {
                padding: 1rem;
            }
            .upcoming-sale-title {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
            }
            .upcoming-sale-description {
                font-size: 0.9rem;
                margin-bottom: 1rem;
            }
        }

        /* Back to Top Button */
        #backToTopBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #backToTopBtn:hover {
            background-color: #4f46e5;
            transform: translateY(-5px);
        }
        #backToTopBtn.show {
            display: flex;
            opacity: 1;
        }
        /* Validation error message styles */
        .error-message {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 0.4rem;
            text-align: left;
            display: block;
        }

        /* Welcome Modal Specific Styles */
        #welcomeModal {
            z-index: 3000;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }
        #welcomeModal .modal-content {
            background: linear-gradient(135deg, #6366f1 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 3rem;
            border-radius: 2rem;
            max-width: 600px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            animation: fadeInScale 0.6s ease-out forwards;
            border: none;
        }
        #welcomeModal .modal-content h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            color: white;
        }
        #welcomeModal .modal-content p.modal-description {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 2.5rem;
            color: #e2e8f0;
        }
        #welcomeModal .modal-content .btn-primary {
            font-size: 1.2rem;
            padding: 1rem 3rem;
            border-radius: 0.8rem;
            background-color: #1a202c;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        #welcomeModal .modal-content .btn-primary:hover {
            background-color: #0d121c;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }
        #welcomeModal .modal-close-btn {
            display: none;
        }

        /* Animation for welcome modal */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Upcoming Sales Carousel specific styles */
        .upcoming-sales-carousel {
            position: relative;
            width: 100%;
            height: 400px;
            margin-bottom: 4rem;
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
            background-color: #2d3748;
            display: flex;
            align-items: center;
        }

        .upcoming-sales-carousel .upcoming-sale-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upcoming-sales-carousel .upcoming-sale-slide.active {
            opacity: 1;
        }

        .upcoming-sales-carousel .upcoming-sale-content {
            background: rgba(0, 0, 0, 0.6);
            padding: 2.5rem;
            border-radius: 1rem;
            text-align: center;
            color: white;
            max-width: 700px;
            backdrop-filter: blur(5px);
        }

        .upcoming-sales-carousel .upcoming-sale-title {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }

        .upcoming-sales-carousel .upcoming-sale-description {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* New styles for category tabs */
        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.8rem;
            margin-bottom: 3rem;
            background-color: #2d3748;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .category-tab-btn {
            background-color: #4a5568;
            color: #e2e8f0;
            padding: 0.8rem 1.5rem;
            border-radius: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            white-space: nowrap; /* Prevent text wrapping */
            flex-shrink: 0; /* Prevent shrinking */
        }
        .category-tab-btn:hover {
            background-color: #6366f1;
            color: white;
            transform: translateY(-2px);
        }
        .category-tab-btn.active {
            background-color: #6366f1;
            color: white;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.4);
        }

        /* Styles for category product sections */
        .category-product-section {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-out forwards;
        }
        .category-product-section.active {
            display: block;
        }
        .category-product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Adjusted minmax for smaller cards */
            gap: 1.5rem; /* Reduced gap */
            padding-top: 1rem; /* Space from tabs */
            justify-items: center; /* Center items within their grid cells */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Adjustments for product cards within category sections */
        .category-product-section .product-card {
            height: 380px; /* Adjusted fixed height for smaller cards */
        }

        /* Hero Carousel specific styles */
        .hero-carousel {
            position: relative;
            width: 100%;
            height: 500px; /* Fixed height for the hero section */
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
            margin-bottom: 4rem;
            background-color: #2d3748;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-carousel .carousel-slides-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .hero-carousel .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-carousel .hero-slide.active {
            opacity: 1;
        }

        .hero-carousel .hero-content {
            background: rgba(0, 0, 0, 0.6);
            padding: 2.5rem;
            border-radius: 1rem;
            text-align: center;
            color: white;
            max-width: 700px;
            backdrop-filter: blur(5px);
            position: relative; /* Ensure content is above image */
            z-index: 2;
        }

        .hero-carousel .hero-title {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }

        .hero-carousel .hero-description {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* Responsive adjustments for hero carousel */
        @media (max-width: 767px) {
            .hero-carousel {
                height: 350px;
            }
            .hero-carousel .hero-content {
                padding: 1.5rem;
            }
            .hero-carousel .hero-title {
                font-size: 2.2rem;
            }
            .hero-carousel .hero-description {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal-overlay show">
        <div class="modal-content">
            <h3>¬°Bienvenido al Futuro con ASG Empire!</h3>
            <p class="modal-description">
                Prep√°rate para explorar un universo de innovaci√≥n donde la tecnolog√≠a de vanguardia
                se une al dise√±o excepcional. Descubre productos que no solo transformar√°n tu d√≠a a d√≠a,
                sino que te llevar√°n un paso adelante.
                <br><br>
                **Tu aventura tecnol√≥gica comienza aqu√≠.**
            </p>
            <button class="btn btn-primary" id="enterSiteBtn">INGRESAR</button>
        </div>
    </div>

    <!-- Encabezado -->
    <header class="header">
        <!-- Logo en la izquierda -->
        <a href="#" class="logo" id="headerLogo">ASG Empire</a>

        <!-- Barra de b√∫squeda en el centro -->
        <div class="header-search-container">
            <input type="text" id="searchInput" placeholder="Buscar productos..." class="search-input">
            <button id="searchBtn" class="search-btn">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <!-- Grupo de navegaci√≥n y carrito a la derecha -->
        <div class="header-group right-group flex items-center gap-4 md:order-none order-last w-full md:w-auto">
            <nav class="header-nav hidden md:flex gap-4">
                <a href="#products" class="nav-link">Productos</a>
                <a href="#features" class="nav-link">Caracter√≠sticas</a>
                <a href="#upcoming-sales" class="nav-link">Pr√≥ximas Ventas</a>
                <a href="#advantages" class="nav-link">Ventajas</a>
                <a href="#order-comments-section" class="nav-link">Comentarios</a>
                <a href="#faq" class="nav-link">FAQ</a>
                <a href="#contact" class="nav-link">Contacto</a>
            </nav>
            <button id="cartBtn" class="cart-icon-btn flex-shrink-0" aria-label="Ver carrito de compras">
                <i class="fas fa-shopping-cart"></i>
                <span id="cartCount" class="cart-count hidden" aria-live="polite" aria-atomic="true">0</span>
            </button>
        </div>

        <!-- Mobile menu button (if needed, currently not fully functional) -->
        <button class="md:hidden text-gray-800 text-2xl" aria-label="Abrir men√∫ de navegaci√≥n">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- Wishlist Sidebar -->
    <aside id="wishlistSidebar" class="fixed top-0 left:0 h-full w-64 bg-gray-800 shadow-lg z-50 p-4 pt-24 flex-col" aria-label="Lista de deseos">
        <h3 class="font-poppins text-xl font-bold text-white mb-4">Tu Lista de Deseos</h3>
        <div id="wishlistSidebarItems" class="space-y-3 overflow-y-auto flex-grow">
            <!-- Wishlist items will be rendered here -->
            <p id="emptyWishlistSidebarMessage" class="text-gray-400 text-sm text-center">Tu lista de deseos est√° vac√≠a.</p>
        </div>
        <button id="clearWishlistSidebarBtn" class="btn btn-secondary w-full mt-4 hidden" aria-label="Vaciar lista de deseos">Vaciar Lista</button>
    </aside>

    <!-- Wishlist Toggle Button -->
    <button id="wishlistToggleButton" aria-label="Alternar barra lateral de lista de deseos">
        <i class="fas fa-chevron-left"></i> <!-- Initial icon for closing -->
    </button>

    <div class="container"> <!-- Main content is now visible by default -->
        <!-- Hero Section with Carousel -->
        <section id="hero-carousel" class="hero-carousel" role="region" aria-label="Bienvenida y Promoci√≥n Principal">
            <div class="carousel-slides-container">
                <div class="hero-slide active" style="background-image: url('https://i.imgur.com/j667u95.png');" role="group" aria-label="Diapositiva 1 de 2">
                    <div class="hero-content">
                        <h1 class="hero-title text-shadow-lg">¬°El Futuro es Ahora con ASG Empire!</h1>
                        <p class="hero-description">Descubre la tecnolog√≠a de vanguardia dise√±ada para transformar tu vida.</p>
                        <a href="#products" class="inline-flex items-center bg-indigo-500 text-white hover:bg-indigo-600 font-bold py-3 px-8 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1" aria-label="Explorar nuestros productos">
                            Explorar Productos
                            <svg class="w-6 h-6 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </a>
                    </div>
                </div>
                <div class="hero-slide" style="background-image: url('https://i.imgur.com/uKO3E6W.png');" role="group" aria-label="Diapositiva 2 de 2">
                    <div class="hero-content">
                        <h1 class="hero-title text-shadow-lg">Innovaci√≥n que Impulsa tu Mundo</h1>
                        <p class="hero-description">Tecnolog√≠a avanzada y dise√±o excepcional para una experiencia inigualable.</p>
                        <a href="#products" class="inline-flex items-center bg-indigo-500 text-white hover:bg-indigo-600 font-bold py-3 px-8 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1" aria-label="Descubrir m√°s productos">
                            Descubrir M√°s
                            <svg class="w-6 h-6 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
            <button class="carousel-nav-btn left" id="heroPrev" aria-label="Diapositiva anterior"><i class="fas fa-chevron-left"></i></button>
            <button class="carousel-nav-btn right" id="heroNext" aria-label="Diapositiva siguiente"><i class="fas fa-chevron-right"></i></button>
            <div class="carousel-dots" id="heroDots" role="tablist" aria-label="Navegaci√≥n de diapositivas"></div>
        </section>

        <!-- Feature Section -->
        <section id="features" class="mb-24">
            <h2 class="section-heading">¬øPor Qu√© Elegir ASG Empire?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <div class="feature-card">
                    <i class="fas fa-rocket feature-icon" aria-hidden="true"></i>
                    <h3 class="feature-title">Tecnolog√≠a de Vanguardia</h3>
                    <p class="feature-description">Siempre a la √∫ltima, con productos que te ponen un paso adelante.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-check-circle feature-icon" aria-hidden="true"></i>
                    <h3 class="feature-title">Calidad Certificada</h3>
                    <p class="feature-description">Cada producto pasa por rigurosos controles para asegurar tu satisfacci√≥n.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-shipping-fast feature-icon" aria-hidden="true"></i>
                    <h3 class="feature-title">Env√≠o R√°pido y Seguro</h3>
                    <p class="feature-description">Entregas eficientes y confiables directo a tu puerta, en todo el mundo.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-headset feature-icon" aria-hidden="true"></i>
                    <h3 class="feature-title">Soporte 24/7</h3>
                    <p class="feature-description">Nuestro equipo siempre listo para ayudarte, en cualquier momento que lo necesites.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-star feature-icon" aria-hidden="true"></i>
                    <h3 class="feature-title">Experiencia de Usuario Premium</h3>
                    <p class="feature-description">Dise√±o intuitivo y funcionalidad impecable para una interacci√≥n fluida.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-shield-alt feature-icon" aria-hidden="true"></i>
                    <h3 class="feature-title">Seguridad Garantizada</h3>
                    <p class="feature-description">Tus datos y transacciones protegidos con la m√°s alta tecnolog√≠a de encriptaci√≥n.</p>
                </div>
            </div>
        </section>

        <!-- Products by Category Section -->
        <section id="products" class="mb-24">
            <h2 class="section-heading">Nuestros Productos por Categor√≠a</h2>

            <!-- Category Tabs -->
            <div class="category-tabs" id="categoryTabs" role="tablist">
                <!-- Category buttons will be injected here by JS -->
            </div>

            <!-- Product Grids for each Category -->
            <div id="categoryProductSections">
                <!-- Product grids for each category will be injected here by JS -->
            </div>
        </section>

        <!-- Upcoming Sales Section (Carousel) -->
        <section id="upcoming-sales" class="mb-24">
            <h2 class="section-heading">Pr√≥ximas Ventas a Agregar</h2>
            <div class="upcoming-sales-carousel" id="upcomingSalesCarousel" role="region" aria-label="Pr√≥ximas Ventas">
                <div class="carousel-slides-container">
                    <div class="upcoming-sale-slide" style="background-image: url('https://placehold.co/1200x400/1e3a8a/e0e7ff?text=Nuevo+Smartwatch');" role="group" aria-label="Diapositiva 1 de 6">
                        <div class="upcoming-sale-content">
                            <h3 class="upcoming-sale-title">Smartwatch Aura X2</h3>
                            <p class="upcoming-sale-description">La pr√≥xima generaci√≥n de wearables con IA integrada. ¬°Mantente conectado y saludable!</p>
                        </div>
                    </div>
                    <div class="upcoming-sale-slide" style="background-image: url('https://placehold.co/1200x400/4c0519/fecaca?text=Drone+Profesional');" role="group" aria-label="Diapositiva 2 de 6">
                        <div class="upcoming-sale-content">
                            <h3 class="upcoming-sale-title">Drone Profesional Phantom 7</h3>
                            <p class="upcoming-sale-description">Captura el mundo desde nuevas alturas con nuestra c√°mara 8K y estabilidad de vuelo.</p>
                        </div>
                    </div>
                    <div class="upcoming-sale-slide" style="background-image: url('https://placehold.co/1200x400/064e3b/d1fae5?text=Consola+Retro');" role="group" aria-label="Diapositiva 3 de 6">
                        <div class="upcoming-sale-content">
                            <h3 class="upcoming-sale-title">Consola Retro Genesis Max</h3>
                            <p class="upcoming-sale-description">Revive la nostalgia con m√°s de 1000 juegos cl√°sicos en 4K. ¬°Diversi√≥n garantizada!</p>
                        </div>
                    </div>
                    <div class="upcoming-sale-slide" style="background-image: url('https://placehold.co/1200x400/312e81/c7d2fe?text=Auriculares+Inalambricos');" role="group" aria-label="Diapositiva 4 de 6">
                        <div class="upcoming-sale-content">
                            <h3 class="upcoming-sale-title">Auriculares Inal√°mbricos Sonido 3D</h3>
                            <p class="upcoming-sale-description">Sum√©rgete en una experiencia de audio sin igual con cancelaci√≥n de ruido activa.</p>
                        </div>
                    </div>
                    <div class="upcoming-sale-slide" style="background-image: url('https://placehold.co/1200x400/be123c/fee2e2?text=Robot+Limpieza');" role="group" aria-label="Diapositiva 5 de 6">
                        <div class="upcoming-sale-content">
                            <h3 class="upcoming-sale-title">Robot de Limpieza Inteligente</h3>
                            <p class="upcoming-sale-description">Tu hogar siempre impecable con este asistente de limpieza totalmente aut√≥nomo.</p>
                        </div>
                    </div>
                    <div class="upcoming-sale-slide" style="background-image: url('https://placehold.co/1200x400/047857/d1fae5?text=Mini+Proyector+4K');" role="group" aria-label="Diapositiva 6 de 6">
                        <div class="upcoming-sale-content">
                            <h3 class="upcoming-sale-title">Mini Proyector Port√°til 4K</h3>
                            <p class="upcoming-sale-description">Lleva el cine a cualquier parte con una calidad de imagen asombrosa en un tama√±o compacto.</p>
                        </div>
                    </div>
                </div>

                <button class="carousel-nav-btn left" id="upcomingSalesPrev" aria-label="Diapositiva anterior"><i class="fas fa-chevron-left"></i></button>
                <button class="carousel-nav-btn right" id="upcomingSalesNext" aria-label="Diapositiva siguiente"><i class="fas fa-chevron-right"></i></button>
                <div class="carousel-dots" id="upcomingSalesDots" role="tablist" aria-label="Navegaci√≥n de diapositivas"></div>
            </div>
        </section>

        <!-- New Section: Exclusive ASG Empire Advantages -->
        <section id="advantages" class="advantages-section">
            <h2 class="section-heading">Ventajas Exclusivas ASG Empire</h2>
            <div class="advantages-grid">
                <div class="advantage-card">
                    <div class="advantage-icon">
                        <i class="fas fa-lightbulb" aria-hidden="true"></i>
                    </div>
                    <h3 class="advantage-title">Innovaci√≥n Constante</h3>
                    <p class="advantage-description">Siempre a la vanguardia con los √∫ltimos avances tecnol√≥gicos para ti.</p>
                </div>
                <div class="advantage-card">
                    <div class="advantage-icon">
                        <i class="fas fa-headset" aria-hidden="true"></i>
                    </div>
                    <h3 class="advantage-title">Soporte Dedicado 24/7</h3>
                    <p class="advantage-description">Nuestro equipo experto est√° siempre listo para asistirte, d√≠a y noche.</p>
                </div>
                <div class="advantage-card">
                    <div class="advantage-icon">
                        <i class="fas fa-shield-alt" aria-hidden="true"></i>
                    </div>
                    <h3 class="advantage-title">Seguridad Inquebrantable</h3>
                    <p class="advantage-description">Tus datos y transacciones protegidos con la m√°s alta tecnolog√≠a de cifrado.</p>
                </div>
                <div class="advantage-card">
                    <div class="advantage-icon">
                        <i class="fas fa-shipping-fast" aria-hidden="true"></i>
                    </div>
                    <h3 class="advantage-title">Entrega Ultra R√°pida</h3>
                    <p class="advantage-description">Recibe tus productos en tiempo r√©cord, directamente en tu puerta.</p>
                </div>
            </div>
        </section>

        <!-- Order Comments Section (formerly Reviews) -->
        <section id="order-comments-section" class="mb-24">
            <h2 class="section-heading">Comentarios de Pedidos</h2>
            <div class="max-w-3xl mx-auto">
                <div class="comments-section">
                    <h4>Comentarios de Clientes</h4>
                    <div id="commentsList" class="comments-list" role="log" aria-live="polite">
                        <!-- Comments will be loaded here -->
                        <p id="noCommentsMessage" class="empty-cart-message">S√© el primero en dejar un comentario.</p>
                    </div>

                    <form id="addCommentForm" class="add-comment-form" aria-label="Formulario para a√±adir comentario">
                        <h5 class="text-lg font-bold text-white mb-3">Deja Tu Comentario:</h5>
                        <div class="modal-form-group">
                            <label for="commenterName">Tu Nombre:</label>
                            <input type="text" id="commenterName" placeholder="Ej. Juan P√©rez" required aria-required="true">
                        </div>
                        <div class="modal-form-group">
                            <label for="commentText">Tu Comentario:</label>
                            <textarea id="commentText" rows="4" placeholder="Comparte tu experiencia con tu pedido o la tienda..." required aria-required="true"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Enviar Comentario</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="mb-24">
            <h2 class="section-heading">Preguntas Frecuentes</h2>
            <div class="max-w-3xl mx-auto">
                <div class="faq-item">
                    <div class="faq-question" role="button" aria-expanded="false" tabindex="0">
                        ¬øCu√°l es el tiempo de env√≠o estimado?
                        <i class="fas fa-chevron-down faq-toggle-icon" aria-hidden="true"></i>
                    </div>
                    <div class="faq-answer" role="region" aria-hidden="true">
                        El tiempo de entrega estimado es de 7 a 18 d√≠as h√°biles, dependiendo de tu ubicaci√≥n. Hacemos todo lo posible para que tu pedido llegue lo antes posible.
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" role="button" aria-expanded="false" tabindex="0">
                        ¬øOfrecen garant√≠a de satisfacci√≥n?
                        <i class="fas fa-chevron-down faq-toggle-icon" aria-hidden="true"></i>
                    </div>
                    <div class="faq-answer" role="region" aria-hidden="true">
                        S√≠, ofrecemos una garant√≠a de satisfacci√≥n de 30 d√≠as. Si no est√°s completamente contento con tu compra, cont√°ctanos para procesar una devoluci√≥n o cambio.
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" role="button" aria-expanded="false" tabindex="0">
                        ¬øC√≥mo puedo rastrear mi pedido?
                        <i class="fas fa-chevron-down faq-toggle-icon" aria-hidden="true"></i>
                    </div>
                    <div class="faq-answer" role="region" aria-hidden="true">
                        Una vez que tu pedido sea enviado, recibir√°s un correo electr√≥nico con un n√∫mero de seguimiento. Podr√°s usarlo en nuestra secci√≥n de rastreo de pedidos.
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" role="button" aria-expanded="false" tabindex="0">
                        ¬øEs seguro comprar en esta p√°gina?
                        <i class="fas fa-chevron-down faq-toggle-icon" aria-hidden="true"></i>
                    </div>
                    <div class="faq-answer" role="region" aria-hidden="true">
                        Absolutamente. Utilizamos encriptaci√≥n SSL y pasarelas de pago seguras para proteger tu informaci√≥n personal y financiera. Tu seguridad es nuestra prioridad.
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="container mx-auto py-12 px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-left">
                <!-- Column 1: Logo and About Us -->
                <div>
                    <div class="logo text-3xl mb-4">ASG Empire</div>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        En ASG Empire, nos dedicamos a traer la innovaci√≥n del futuro a tu presente.
                        Explora nuestra selecci√≥n de productos de vanguardia dise√±ados para mejorar tu vida.
                    </p>
                </div>

                <!-- Column 2: Navigation Links -->
                <div>
                    <h4 class="text-lg font-bold text-white mb-4">Explorar</h4>
                    <ul class="space-y-2">
                        <li><a href="#products" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Productos</a></li>
                        <li><a href="#features" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Caracter√≠sticas</a></li>
                        <li><a href="#upcoming-sales" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Pr√≥ximas Ventas</a></li>
                        <li><a href="#advantages" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Ventajas</a></li>
                    </ul>
                </div>

                <!-- Column 3: Support and Help -->
                <div>
                    <h4 class="text-lg font-bold text-white mb-4">Soporte</h4>
                    <ul class="space-y-2">
                        <li><a href="#faq" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Preguntas Frecuentes</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Centro de Ayuda</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Devoluciones y Env√≠os</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200">Garant√≠a</a></li>
                    </ul>
                </div>

                <!-- Column 4: Contact and Newsletter -->
                <div>
                    <h4 class="text-lg font-bold text-white mb-4">Mantente Conectado</h4>
                    <p class="text-gray-400 text-sm mb-4">
                        Recibe las √∫ltimas noticias y ofertas exclusivas directamente en tu bandeja de entrada.
                    </p>
                    <form class="flex flex-col sm:flex-row gap-2 mb-6" aria-label="Formulario de suscripci√≥n al bolet√≠n">
                        <input type="email" placeholder="Tu correo electr√≥nico" class="flex-grow p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-indigo-500" aria-label="Correo electr√≥nico para suscribirse">
                        <button type="submit" class="btn btn-primary px-4 py-3 text-sm">Suscribirme</button>
                    </form>
                    <div class="social-icons flex gap-4 justify-start">
                        <a href="#" aria-label="Facebook" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200 text-2xl"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200 text-2xl"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Twitter" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200 text-2xl"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="YouTube" class="text-gray-400 hover:text-indigo-400 transition-colors duration-200 text-2xl"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-400 text-sm">&copy; 2025 ASG Empire. Todos los derechos reservados. Dise√±ado para dominar por Gemini.</p>
                <p id="userIdDisplay" class="text-gray-500 text-xs mt-2 hidden">User ID: </p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" aria-label="Volver arriba">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Item Added Confirmation Modal -->
    <div id="itemAddedModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="itemAddedModalTitle">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeItemAddedModalBtn" aria-label="Cerrar modal">&times;</button>
            <h3 id="itemAddedModalTitle">¬°Producto A√±adido al Carrito!</h3>
            <p id="itemAddedMessage">"Producto" ha sido a√±adido a tu carrito.</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="viewCartFromAddedModal">Ver Carrito</button>
                <button class="btn btn-secondary" id="continueShoppingBtn">Seguir Comprando</button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="cartModalTitle">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeCartModalBtn" aria-label="Cerrar modal">&times;</button>
            <h3 id="cartModalTitle">Tu Carrito de Compras ASG</h3>
            <div id="cartItemsContainer" class="mb-4">
                <!-- Cart items will be loaded here -->
                <p id="emptyCartMessage" class="empty-cart-message">Tu carrito est√° vac√≠o. ¬°Explora nuestros productos!</p>
            </div>
            <div id="cartTotalContainer" class="cart-total hidden">
                Total: S/. <span id="cartTotalPrice">0.00</span>
            </div>
            <div class="modal-buttons">
                <button id="checkoutBtn" class="btn btn-primary hidden">Proceder al Pago</button>
                <button type="button" class="btn btn-secondary" id="clearCartBtn">Vaciar Carrito</button>
            </div>
        </div>
    </div>

    <!-- Purchase Confirmation Modal -->
    <div id="purchaseConfirmModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="purchaseConfirmModalTitle">
        <div class="modal-content">
            <button class="modal-close-btn" id="closePurchaseConfirmModalBtn" aria-label="Cerrar modal">&times;</button>
            <h3 id="purchaseConfirmModalTitle">Confirmar Tu Pedido</h3>
            <!-- Warning message -->
            <p class="warning-message" role="alert">
                <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                Ingresar datos correctos, el vendedor no se har√° responsable del mal colocamiento de Direcci√≥n o Correo Electr√≥nico.
            </p>
            <form id="purchaseConfirmForm" aria-label="Formulario de confirmaci√≥n de compra">
                <div class="modal-form-group">
                    <label for="confirmName">Nombre Completo:</label>
                    <input type="text" id="confirmName" placeholder="Tu Nombre" required aria-required="true">
                </div>
                <div class="modal-form-group">
                    <label for="confirmEmail">Correo Electr√≥nico:</label>
                    <input type="email" id="confirmEmail" placeholder="tu@ejemplo.com" required aria-required="true">
                    <span id="emailError" class="error-message hidden" aria-live="assertive">Por favor, ingresa un correo electr√≥nico v√°lido (ej. @gmail.com, @hotmail.com, @outlook.com).</span>
                </div>
                <div class="modal-form-group">
                    <label for="confirmPhone">Tel√©fono (Opcional):</label>
                    <input type="tel" id="confirmPhone" placeholder="+51 987 654 321">
                </div>
                <div class="modal-form-group">
                    <label for="confirmAddress">Direcci√≥n de Env√≠o Completa:</label>
                    <textarea id="confirmAddress" rows="4" placeholder="Calle, n√∫mero, departamento, ciudad, c√≥digo postal" required aria-required="true"></textarea>
                </div>
                <div class="modal-form-group">
                    <label>Productos en Carrito:</label>
                    <ul id="confirmCartSummary" class="text-sm text-gray-700 bg-gray-100 p-3 rounded-md max-h-40 overflow-y-auto" aria-live="polite">
                        <!-- Cart summary will be injected here -->
                    </ul>
                </div>
                <div class="cart-total text-right mt-4">
                    Total a Pagar: S/. <span id="confirmTotalPrice">0.00</span>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary">Finalizar Compra</button>
                    <button type="button" class="btn btn-secondary" id="cancelPurchaseConfirmModalBtn">Volver al Carrito</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Wishlist Modal (kept as an alternative/mobile view) -->
    <div id="wishlistModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="wishlistModalTitle">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeWishlistModalBtn" aria-label="Cerrar modal">&times;</button>
            <h3 id="wishlistModalTitle">Tu Lista de Deseos ASG</h3>
            <div id="wishlistItemsContainer" class="mb-4">
                <!-- Wishlist items will be loaded here -->
                <p id="emptyWishlistMessage" class="empty-cart-message">Tu lista de deseos est√° vac√≠a. ¬°A√±ade tus favoritos!</p>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" id="clearWishlistBtn">Vaciar Lista</button>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productDetailModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="productDetailTitle">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeProductDetailModalBtn" aria-label="Cerrar modal">&times;</button>
            <div class="product-detail-grid">
                <div class="product-detail-left-column">
                    <!-- Product Image Carousel -->
                    <div class="product-image-carousel" id="productImageCarousel" role="region" aria-label="Carrusel de im√°genes del producto">
                        <div class="carousel-slides-container">
                            <!-- Image slides will be loaded here -->
                        </div>
                        <button class="carousel-nav-btn left" id="productImagePrev" aria-label="Imagen anterior"><i class="fas fa-chevron-left"></i></button>
                        <button class="carousel-nav-btn right" id="productImageNext" aria-label="Imagen siguiente"><i class="fas fa-chevron-right"></i></button>
                        <div class="carousel-dots" id="productImageDots" role="tablist" aria-label="Navegaci√≥n de im√°genes"></div>
                    </div>
                </div>
                <div class="product-detail-right-column">
                    <h3 id="productDetailTitle" class="product-detail-title"></h3>
                    <div id="productDetailPriceContainer" class="product-detail-price-container">
                        <div class="product-detail-price-info">
                            <span id="productDetailCurrentPrice" class="product-detail-current-price"></span>
                            <span id="productDetailOldPrice" class="product-detail-old-price"></span>
                            <span id="productDetailDiscountPercentage" class="product-detail-discount-percentage"></span>
                        </div>
                        <span id="productDetailPriceNote" class="product-detail-price-note">Precio mostrado antes de impuestos</span>
                    </div>

                    <p id="productDetailDescription" class="product-detail-description"></p>

                    <!-- Quantity Selector -->
                    <div class="quantity-selector-group">
                        <label for="productQuantity" class="text-sm font-semibold text-gray-300 mb-2 block">Cantidad:</label>
                        <div class="flex items-center gap-2">
                            <button id="decreaseQuantityBtn" class="btn-icon text-lg" aria-label="Disminuir cantidad"><i class="fas fa-minus-circle"></i></button>
                            <input type="number" id="productQuantity" value="1" min="1" class="w-16 text-center bg-gray-700 border border-gray-600 rounded-md py-2 text-white" aria-label="Cantidad del producto">
                            <button id="increaseQuantityBtn" class="btn-icon text-lg" aria-label="Aumentar cantidad"><i class="fas fa-plus-circle"></i></button>
                        </div>
                    </div>

                    <div class="modal-buttons flex-col mt-4">
                        <button id="addToCartFromDetailBtn" class="btn btn-primary w-full mb-2">A√±adir al Carrito</button>
                        <button id="buyNowBtn" class="btn btn-secondary w-full">Comprar Ahora</button>
                    </div>

                    <div class="product-detail-specs mt-6 pt-4 border-t border-gray-700">
                        <h4 class="text-lg font-bold text-white mb-2">Especificaciones T√©cnicas:</h4>
                        <ul id="productDetailSpecsList" class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                            <!-- Specs will be loaded here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- All Products Modal -->
    <div id="allProductsModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="allProductsModalTitle">
        <div class="modal-content max-w-6xl w-11/12 h-5/6 overflow-y-auto">
            <button class="modal-close-btn" id="closeAllProductsModalBtn" aria-label="Cerrar modal">&times;</button>
            <h3 id="allProductsModalTitle" class="text-center mb-6">Todos Nuestros Productos</h3>
            <div id="allProductsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- All products will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Smooth scrolling for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        window.onload = async () => {
            // DOM element declarations
            const welcomeModal = document.getElementById('welcomeModal');
            const enterSiteBtn = document.getElementById('enterSiteBtn');
            const mainContentContainer = document.querySelector('.container');

            const itemAddedModal = document.getElementById('itemAddedModal');
            const closeItemAddedModalBtn = document.getElementById('closeItemAddedModalBtn');
            const itemAddedMessage = document.getElementById('itemAddedMessage');
            const viewCartFromAddedModal = document.getElementById('viewCartFromAddedModal');
            const continueShoppingBtn = document.getElementById('continueShoppingBtn');

            const cartBtn = document.getElementById('cartBtn');
            const cartModal = document.getElementById('cartModal');
            const closeCartModalBtn = document.getElementById('closeCartModalBtn');
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            const cartTotalContainer = document.getElementById('cartTotalContainer');
            const cartTotalPriceElem = document.getElementById('cartTotalPrice');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const clearCartBtn = document.getElementById('clearCartBtn');
            const cartCountElem = document.getElementById('cartCount');

            const purchaseConfirmModal = document.getElementById('purchaseConfirmModal');
            const closePurchaseConfirmModalBtn = document.getElementById('closePurchaseConfirmModalBtn');
            const cancelPurchaseConfirmModalBtn = document.getElementById('cancelPurchaseConfirmModalBtn');
            const purchaseConfirmForm = document.getElementById('purchaseConfirmForm');
            const confirmCartSummary = document.getElementById('confirmCartSummary');
            const confirmTotalPriceElem = document.getElementById('confirmTotalPrice');
            const confirmEmailInput = document.getElementById('confirmEmail');
            const emailErrorSpan = document.getElementById('emailError');

            const wishlistModal = document.getElementById('wishlistModal');
            const closeWishlistModalBtn = document.getElementById('closeWishlistModalBtn');
            const wishlistItemsContainer = document.getElementById('wishlistItemsContainer');
            const emptyWishlistMessage = document.getElementById('emptyWishlistMessage');
            const clearWishlistBtn = document.getElementById('clearWishlistBtn');
            const wishlistIcons = document.querySelectorAll('.wishlist-icon');

            const wishlistSidebar = document.getElementById('wishlistSidebar');
            const wishlistSidebarItems = document.getElementById('wishlistSidebarItems');
            const emptyWishlistSidebarMessage = document.getElementById('emptyWishlistSidebarMessage');
            const clearWishlistSidebarBtn = document.getElementById('clearWishlistSidebarBtn');
            const wishlistToggleButton = document.getElementById('wishlistToggleButton');


            const productDetailModal = document.getElementById('productDetailModal');
            const closeProductDetailModalBtn = document.getElementById('closeProductDetailModalBtn');
            const productDetailTitle = document.getElementById('productDetailTitle');
            const productDetailCurrentPrice = document.getElementById('productDetailCurrentPrice');
            const productDetailOldPrice = document.getElementById('productDetailOldPrice');
            const productDetailDiscountPercentage = document.getElementById('productDetailDiscountPercentage');
            const productDetailPriceNote = document.getElementById('productDetailPriceNote');
            const productDetailDescription = document.getElementById('productDetailDescription');
            const productDetailSpecsList = document.getElementById('productDetailSpecsList');
            const addToCartFromDetailBtn = document.getElementById('addToCartFromDetailBtn');
            const buyNowBtn = document.getElementById('buyNowBtn');

            const productQuantityInput = document.getElementById('productQuantity');
            const decreaseQuantityBtn = document.getElementById('decreaseQuantityBtn');
            const increaseQuantityBtn = document.getElementById('increaseQuantityBtn');

            const backToTopBtn = document.getElementById('backToTopBtn');

            const headerLogo = document.getElementById('headerLogo');
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');

            const allProductsModal = document.getElementById('allProductsModal');
            const closeAllProductsModalBtn = document.getElementById('closeAllProductsModalBtn');
            const allProductsGrid = document.getElementById('allProductsGrid');
            const getMoreProductsBtn = document.getElementById('getMoreProductsBtn'); // This button will be removed or repurposed

            const commentsList = document.getElementById('commentsList');
            const noCommentsMessage = document.getElementById('noCommentsMessage');
            const addCommentForm = document.getElementById('addCommentForm');
            const commenterNameInput = document.getElementById('commenterName');
            const commentTextInput = document.getElementById('commentText');

            const userIdDisplayElem = document.getElementById('userIdDisplay');

            // New category specific elements
            const categoryTabsContainer = document.getElementById('categoryTabs');
            const categoryProductSectionsContainer = document.getElementById('categoryProductSections');


            // Firebase Initialization
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
                apiKey: "YOUR_API_KEY",
                authDomain: "YOUR_AUTH_DOMAIN",
                projectId: "YOUR_PROJECT_ID",
                storageBucket: "YOUR_STORAGE_BUCKET",
                messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
                appId: "YOUR_APP_ID"
            };

            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.getFirestore(app);
            const auth = firebase.getAuth(app);

            let userId = null;
            let isAuthReady = false;
            let currentCommentsUnsubscribe = null;

            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            firebase.onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("Authenticated with UID:", userId);
                } else {
                    if (initialAuthToken) {
                        try {
                            await firebase.signInWithCustomToken(auth, initialAuthToken);
                            userId = auth.currentUser.uid;
                            console.log("Signed in with custom token, UID:", userId);
                        } catch (error) {
                            console.error("Error signing in with custom token:", error);
                            try {
                                const anonymousUser = await firebase.signInAnonymously(auth);
                                userId = anonymousUser.user.uid;
                                console.log("Signed in anonymously after custom token failure, UID:", userId);
                            } catch (anonError) {
                                console.error("Error signing in anonymously:", anonError);
                            }
                        }
                    } else {
                        try {
                            const anonymousUser = await firebase.signInAnonymously(auth);
                            userId = anonymousUser.user.uid;
                            console.log("Signed in anonymously, UID:", userId);
                        } catch (error) {
                            console.error("Error signing in anonymously:", error);
                        }
                    }
                }
                isAuthReady = true;
                fetchAndDisplayComments();

                if (userIdDisplayElem && userId) {
                    userIdDisplayElem.textContent = `User ID: ${userId}`;
                    userIdDisplayElem.classList.remove('hidden');
                }
            });


            // Product array with complete details (reviews will be loaded from Firestore)
            const products = [
                {
                    id: 'prod001',
                    name: 'üì±üß® POWER BANK XIAOMI 200,000 mAh ‚Äì CARGA SUPER R√ÅPIDA 120W',
                    price: 78.99,
                    oldPrice: 105.32,
                    discountPercentage: 25,
                    image: 'https://i.imgur.com/4wDofU3.png',
                    description: 'Experimenta la inmersi√≥n total con los Auriculares Gamer Quantum. Sonido envolvente 7.1, micr√≥fono con cancelaci√≥n de ruido y almohadillas de memoria para horas de comodidad. Compatibles con PC, PlayStation y Xbox.',
                    specs: [
                        'Sonido envolvente 7.1',
                        'Micr√≥fono retr√°ctil con cancelaci√≥n de ruido',
                        'Almohadillas de espuma con memoria',
                        'Conexi√≥n USB y 3.5mm',
                        'Iluminaci√≥n RGB personalizable'
                    ],
                    galleryImages: [
                        'https://i.imgur.com/4wDofU3.png',
                        'https://i.imgur.com/mI3CgOh.png',
                        'https://i.imgur.com/Bv9CWZD.png',
                        'https://i.imgur.com/bqJ36tv.png'
                    ],
                    category: 'Electr√≥nica y dispositivos inteligentes'
                },
                {
                    id: 'prod002',
                    name: 'Cargador r√°pido USB de 90W ‚Äì Turbo Cable de carga USB tipo C de carga r√°pida',
                    price: 69.90,
                    oldPrice: 99.90,
                    discountPercentage: 30,
                    image: 'https://i.imgur.com/eb88fRT.jpeg',
                    description: 'Experimenta la velocidad de carga definitiva con nuestro Cargador R√°pido USB de 90W. Dise√±ado para dispositivos modernos con puerto USB Tipo C, ofrece una carga turbo eficiente y segura, ideal para smartphones, tablets y laptops. Incluye un cable de carga robusto y duradero.',
                    specs: [
                        'Potencia de Salida: 90W (M√°x.)',
                        'Tipo de Conector: USB Tipo C',
                        'Tecnolog√≠a de Carga: Carga R√°pida / Turbo Carga',
                        'Compatibilidad: Smartphones, Tablets, Laptops con USB-C',
                        'Seguridad: Protecci√≥n contra sobrecarga, sobrecalentamiento, cortocircuito',
                        'Material del Cable: TPE reforzado para durabilidad'
                    ],
                    galleryImages: [
                        'https://i.imgur.com/18yQprq.jpeg',
                        'https://i.imgur.com/zfpMtAQ.jpeg',
                        'https://i.imgur.com/QT4MPMJ.jpeg',
                        'https://i.imgur.com/tkSvlFr.jpeg'
                    ],
                    category: 'Electr√≥nica y dispositivos inteligentes'
                },
                {
                    id: 'prod003',
                    name: 'Banco de energ√≠a solar ‚Äì Bater√≠a de carga r√°pida m√≥vil de gran capacidad mAh con cables USB 4 duales',
                    price: 78.99,
                    oldPrice: 105.32,
                    discountPercentage: 25,
                    image: 'https://i.imgur.com/PO98ewp.jpeg',
                    description: 'Mantente siempre conectado con nuestro Banco de Energ√≠a Solar de gran capacidad. Equipado con paneles solares para carga de emergencia y una bater√≠a de alta capacidad, este power bank es perfecto para aventuras al aire libre o el uso diario. Incluye 4 cables USB duales integrados para una compatibilidad universal y carga r√°pida.',
                    specs: [
                        'Capacidad: Gran capacidad (mAh no especificado, se asume alto)',
                        'Carga Solar: S√≠, para recarga de emergencia',
                        'Salida: Carga r√°pida con 4 cables USB duales integrados',
                        'Compatibilidad: Universal (USB, USB-C, Micro USB, Lightning)',
                        'Caracter√≠sticas: Resistente al agua y al polvo, linterna LED',
                        'Material: ABS + PC duradero'
                    ],
                    galleryImages: [
                        'https://i.imgur.com/uaaGu3x.jpeg',
                        'https://i.imgur.com/lmlWnoQ.jpeg',
                        'https://i.imgur.com/rJ9XNHt.jpeg',
                        'https://i.imgur.com/q7SZTE2.jpeg'
                    ],
                    category: 'Electr√≥nica y dispositivos inteligentes' // Moved from 'Productos sostenibles y ecol√≥gicos'
                },
                {
                    id: 'prod004',
                    name: 'Nuevo reloj inteligente T800 U2 49mm 2024 nuevo NFC hombres mujeres GPS pista Bluetooth llamada BT juegos de m√∫sica carga inal√°mbrica Smartwatch',
                    price: 68.99,
                    oldPrice: 99.99,
                    discountPercentage: 31,
                    image: 'https://i.imgur.com/8aS8kQP.jpeg',
                    description: 'Descubre la √∫ltima innovaci√≥n con el Smartwatch T800 U2 de 49mm. Este reloj inteligente de 2024 ofrece seguimiento GPS, llamadas Bluetooth, reproducci√≥n de m√∫sica, juegos y carga inal√°mbrica. Ideal para hombres y mujeres que buscan un un dispositivo multifuncional para su vida diaria y deportiva.',
                    specs: [
                        'Tama√±o de Pantalla: 49mm',
                        'Caracter√≠sticas: NFC, GPS, Llamadas Bluetooth, Juegos, M√∫sica',
                        'Carga: Inal√°mbrica',
                        'Compatibilidad: Android e iOS',
                        'Sensores: Monitor de ritmo card√≠aco, ox√≠geno en sangre, sue√±o',
                        'Resistencia al Agua: IP67 (salpicaduras y sudor)',
                        'Bater√≠a: Larga duraci√≥n',
                        'Material: Aleaci√≥n de zinc y silicona'
                    ],
                    galleryImages: [
                        'https://i.imgur.com/Fr27Gpk.jpeg',
                        'https://i.imgur.com/hToqCWJ.jpeg',
                        'https://i.imgur.com/ggwNsSb.jpeg',
                        'https://i.imgur.com/pfLKkLB.jpeg'
                    ],
                    category: 'Electr√≥nica y dispositivos inteligentes'
                },
                {
                    id: 'prod005',
                    name: 'Mu√±equera de soporte para mu√±eca, correas de soporte de fuerza Extra, mu√±equeras para levantamiento de pesas, vendaje, equipo de protecci√≥n para Fitness',
                    price: 24.90,
                    oldPrice: 33.90, // Generated: 24.90 * 1.35 = 33.615, rounded to 33.90
                    discountPercentage: 27, // Calculated: ((33.90 - 24.90) / 33.90) * 100 = 26.5%, rounded to 27
                    image: 'https://i.imgur.com/F9yXHon.jpeg',
                    description: 'Optimiza tu rendimiento y protege tus mu√±ecas con esta mu√±equera de soporte de alta calidad. Dise√±ada para levantamiento de pesas y entrenamientos intensos, proporciona estabilidad extra y compresi√≥n ajustable. Fabricada con materiales duraderos, es esencial para prevenir lesiones y mejorar tu fuerza en cada ejercicio.',
                    specs: [
                        'Material: Neopreno y nylon de alta resistencia',
                        'Soporte: Fuerza extra para mu√±eca',
                        'Ajuste: Correas de velcro ajustables',
                        'Uso: Levantamiento de pesas, fitness, entrenamiento de fuerza',
                        'Protecci√≥n: Previene esguinces y lesiones',
                        'Confort: Transpirable y c√≥modo para uso prolongado'
                    ],
                    galleryImages: [
                        'https://i.imgur.com/s83FESs.jpeg',
                        'https://i.imgur.com/sd4H3Z5.jpeg',
                        'https://i.imgur.com/yJhLvIl.jpeg',
                        'https://i.imgur.com/cWEoz4H.jpeg'
                    ],
                    category: 'Salud, bienestar y fitness'
                },
                {
                    id: 'prod013', // New product ID
                    name: 'Estera de Yoga para Pilates, estera de Fitness de 6mm de espesor, coj√≠n antideslizante para Yoga, almohadilla para ejercicio f√≠sico de viaje para mujeres, gimnasio en casa, entrenamiento en el suelo',
                    price: 34.90,
                    oldPrice: 46.50, // Calculated: 34.90 / 0.75 = 46.53, rounded to 46.50
                    discountPercentage: 25, // Calculated: ((46.50 - 34.90) / 46.50) * 100 = 24.94, rounded to 25
                    image: 'https://i.imgur.com/LBhoNjR.jpeg',
                    description: 'Mejora tu pr√°ctica de yoga y pilates con esta estera de fitness de 6mm de espesor. Su superficie antideslizante proporciona estabilidad y seguridad durante tus ejercicios. Ligera y f√°cil de transportar, es ideal para el gimnasio, el hogar o para llevar de viaje. Perfecta para mujeres que buscan confort y apoyo en su entrenamiento en el suelo.',
                    specs: [
                        'Espesor: 6mm',
                        'Material: TPE de alta densidad, ecol√≥gico y no t√≥xico',
                        'Caracter√≠sticas: Antideslizante, impermeable, f√°cil de limpiar',
                        'Uso: Yoga, Pilates, Fitness, Entrenamiento en el suelo',
                        'Portabilidad: Ligera y enrollable, incluye correa de transporte',
                        'Dimensiones: (aproximadas) 183cm x 61cm'
                    ],
                    galleryImages: [
                        'https://i.imgur.com/jDtxij3.jpeg',
                        'https://i.imgur.com/kngMokV.jpeg',
                        'https://i.imgur.com/hIyid7G.jpeg',
                        'https://i.imgur.com/joLkFUl.jpeg'
                    ],
                    category: 'Salud, bienestar y fitness'
                },
                {
                    id: 'prod006',
                    name: 'Kit de Cultivo Urbano Org√°nico',
                    price: 45.00,
                    oldPrice: 60.00,
                    discountPercentage: 25,
                    image: 'https://placehold.co/400x300/8BC34A/ffffff?text=Cultivo+Organico',
                    description: 'Cultiva tus propias hierbas y vegetales en casa con este kit org√°nico. Incluye semillas, tierra enriquecida y macetas biodegradables. ¬°Sostenibilidad al alcance de tu mano!',
                    specs: [
                        'Semillas org√°nicas certificadas',
                        'Macetas biodegradables',
                        'Tierra enriquecida con nutrientes',
                        'Gu√≠a de cultivo f√°cil',
                        'Ideal para espacios peque√±os'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/8BC34A/ffffff?text=Cultivo+Organico+1',
                        'https://placehold.co/400x300/8BC34A/ffffff?text=Cultivo+Organico+2'
                    ],
                    category: 'Productos sostenibles y ecol√≥gicos'
                },
                {
                    id: 'prod007',
                    name: 'Juguete Interactivo para Perros con Dispensador',
                    price: 25.50,
                    oldPrice: 35.00,
                    discountPercentage: 27,
                    image: 'https://placehold.co/400x300/FFC107/ffffff?text=Juguete+Perro',
                    description: 'Mant√©n a tu mascota entretenida y activa con este juguete interactivo. Dispensador de premios integrado y material resistente para horas de diversi√≥n.',
                    specs: [
                        'Material no t√≥xico y duradero',
                        'Dispensador de premios ajustable',
                        'Estimula la actividad f√≠sica y mental',
                        'F√°cil de limpiar',
                        'Ideal para perros de todos los tama√±os'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/FFC107/ffffff?text=Juguete+Perro+1',
                        'https://placehold.co/400x300/FFC107/ffffff?text=Juguete+Perro+2'
                    ],
                    category: 'Productos para mascotas'
                },
                {
                    id: 'prod008',
                    name: 'Silla Ergon√≥mica Premium para Oficina',
                    price: 349.00,
                    oldPrice: 450.00,
                    discountPercentage: 22,
                    image: 'https://placehold.co/400x300/607D8B/ffffff?text=Silla+Oficina',
                    description: 'Mejora tu productividad y confort con esta silla ergon√≥mica de oficina. Soporte lumbar ajustable, reposabrazos 4D y malla transpirable para largas jornadas de trabajo.',
                    specs: [
                        'Soporte lumbar ajustable',
                        'Reposabrazos 4D',
                        'Malla transpirable de alta calidad',
                        'Base de aluminio resistente',
                        'Ruedas silenciosas'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/607D8B/ffffff?text=Silla+Oficina+1',
                        'https://placehold.co/400x300/607D8B/ffffff?text=Silla+Oficina+2'
                    ],
                    category: 'Oficina en casa y productividad'
                },
                {
                    id: 'prod009',
                    name: 'Mochila Antirrobo con Carga USB',
                    price: 59.99,
                    oldPrice: 80.00,
                    discountPercentage: 25,
                    image: 'https://placehold.co/400x300/9C27B0/ffffff?text=Mochila+Antirrobo',
                    description: 'Protege tus pertenencias con esta mochila antirrobo. Dise√±o elegante, compartimentos ocultos, puerto de carga USB integrado y material resistente al agua.',
                    specs: [
                        'Dise√±o antirrobo con cremalleras ocultas',
                        'Puerto de carga USB externo',
                        'Material impermeable y resistente a cortes',
                        'Compartimento para laptop de 15.6 pulgadas',
                        'Correas acolchadas y transpirables'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/9C27B0/ffffff?text=Mochila+Antirrobo+1',
                        'https://placehold.co/400x300/9C27B0/ffffff?text=Mochila+Antirrobo+2'
                    ],
                    category: 'Moda personalizable y accesorios'
                },
                {
                    id: 'prod010',
                    name: 'Freidora de Aire Inteligente 5L',
                    price: 99.99,
                    oldPrice: 130.00,
                    discountPercentage: 23,
                    image: 'https://placehold.co/400x300/FF5722/ffffff?text=Freidora+Aire',
                    description: 'Cocina de forma saludable y deliciosa con esta freidora de aire inteligente. Capacidad de 5L, 8 programas preestablecidos y control por aplicaci√≥n m√≥vil.',
                    specs: [
                        'Capacidad de 5 litros',
                        '8 programas de cocci√≥n preestablecidos',
                        'Control por aplicaci√≥n m√≥vil y pantalla t√°ctil',
                        'Tecnolog√≠a de circulaci√≥n de aire 360¬∞',
                        'F√°cil de limpiar y apta para lavavajillas'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/FF5722/ffffff?text=Freidora+Aire+1',
                        'https://placehold.co/400x300/FF5722/ffffff?text=Freidora+Aire+2'
                    ],
                    category: 'Cocina, hogar y hobbies'
                },
                {
                    id: 'prod011',
                    name: 'Set de Cuidado Facial Antiedad con Col√°geno',
                    price: 75.00,
                    oldPrice: 100.00,
                    discountPercentage: 25,
                    image: 'https://placehold.co/400x300/E91E63/ffffff?text=Cuidado+Facial',
                    description: 'Revitaliza tu piel con este set de cuidado facial antiedad. Formulado con col√°geno y √°cido hialur√≥nico para reducir arrugas y mejorar la elasticidad.',
                    specs: [
                        'S√©rum de col√°geno',
                        'Crema hidratante con √°cido hialur√≥nico',
                        'Contorno de ojos revitalizante',
                        'Apto para todo tipo de piel',
                        'Resultados visibles en 4 semanas'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/E91E63/ffffff?text=Cuidado+Facial+1',
                        'https://placehold.co/400x300/E91E63/ffffff?text=Cuidado+Facial+2'
                    ],
                    category: 'Belleza y cuidado personal en tendencia'
                },
                {
                    id: 'prod012',
                    name: 'Cafetera Inteligente con Control por App',
                    price: 89.99,
                    oldPrice: 119.99,
                    discountPercentage: 25,
                    image: 'https://placehold.co/400x300/FF5722/ffffff?text=Cafetera+Inteligente',
                    description: 'Prepara tu caf√© perfecto desde cualquier lugar con esta cafetera inteligente. Controla la preparaci√≥n, intensidad y horario desde tu smartphone. Incluye molinillo integrado y filtro reutilizable.',
                    specs: [
                        'Capacidad: 1.2 Litros (10 tazas)',
                        'Conectividad: Wi-Fi, Control por App',
                        'Caracter√≠sticas: Molinillo integrado, filtro reutilizable, programaci√≥n',
                        'Material: Acero inoxidable y vidrio templado',
                        'Compatibilidad: Granos de caf√© y caf√© molido'
                    ],
                    galleryImages: [
                        'https://placehold.co/400x300/FF5722/ffffff?text=Cafetera+Inteligente+1',
                        'https://placehold.co/400x300/FF5722/ffffff?text=Cafetera+Inteligente+2'
                    ],
                    category: 'Cocina, hogar y hobbies'
                }
            ];


            let openModalCount = 0;

            /**
             * Opens a given modal.
             * Closes all other modals before opening a new one.
             * @param {HTMLElement} modalElement
             */
            function openModal(modalElement) {
                document.querySelectorAll('.modal-overlay.show').forEach(openModal => {
                    if (openModal.id !== 'welcomeModal') {
                        closeModal(openModal);
                    }
                });

                modalElement.classList.remove('hidden');
                setTimeout(() => {
                    modalElement.classList.add('show');
                    openModalCount++;
                    document.body.style.overflow = 'hidden';
                }, 10);
            }

            /**
             * Closes a given modal.
             * @param {HTMLElement} modalElement
             */
            function closeModal(modalElement) {
                modalElement.classList.remove('show');
                setTimeout(() => {
                    modalElement.classList.add('hidden');
                    openModalCount--;
                    if (openModalCount <= 0) {
                        document.body.style.overflow = '';
                        openModalCount = 0;
                    }
                }, 400);
            }

            // Event Listeners for Item Added Modal
            closeItemAddedModalBtn.addEventListener('click', () => closeModal(itemAddedModal));
            continueShoppingBtn.addEventListener('click', () => closeModal(itemAddedModal));
            viewCartFromAddedModal.addEventListener('click', () => {
                closeModal(itemAddedModal);
                openModal(cartModal);
            });

            // Close modal when clicking outside the content
            itemAddedModal.addEventListener('click', (e) => {
                if (e.target === itemAddedModal) {
                    closeModal(itemAddedModal);
                }
            });


            // ====================================================================================
            // === GENERAL CAROUSEL LOGIC =========================================================
            // ====================================================================================

            /**
             * Initializes a carousel.
             * @param {string} carouselId - ID of the carousel container.
             * @param {string} prevBtnId - ID of the previous button.
             * @param {string} nextBtnId - ID of the next button.
             * @param {string} dotsId - ID of the dots container.
             * @param {number} intervalTime - Time in ms for automatic sliding.
             * @param {string} slideClass - CSS class for carousel slides (e.g., 'testimonial-slide', 'upcoming-sale-slide').
             * @param {string} slidesContainerClass - CSS class for the slides container within the carousel.
             */
            function initCarousel(carouselId, prevBtnId, nextBtnId, dotsId, intervalTime = 5000, slideClass, slidesContainerClass) {
                const carousel = document.querySelector(`#${carouselId}`);
                if (!carousel) return;

                const slidesContainer = carousel.querySelector(`.${slidesContainerClass}`);
                const slides = slidesContainer ? Array.from(slidesContainer.children) : [];

                if (slides.length <= 1) {
                    if (slides.length === 1) {
                        slides[0].classList.add('active');
                    }
                    const prevBtn = document.getElementById(prevBtnId);
                    const nextBtn = document.getElementById(nextBtnId);
                    const dotsContainer = document.getElementById(dotsId);
                    if (prevBtn) prevBtn.style.display = 'none';
                    if (nextBtn) nextBtn.style.display = 'none';
                    if (dotsContainer) dotsContainer.style.display = 'none';
                    return;
                }

                const prevBtn = document.getElementById(prevBtnId);
                const nextBtn = document.getElementById(nextBtnId);
                const dotsContainer = document.getElementById(dotsId);

                let currentSlideIndex = 0;
                let slideInterval;

                dotsContainer.innerHTML = '';
                let numDots = slides.length;
                // The productCarousel logic is now removed as it's no longer used,
                // but keeping the general structure for future carousel types.

                for(let i = 0; i < numDots; i++) {
                    const dot = document.createElement('span');
                    dot.classList.add('carousel-dot');
                    if (i === 0) dot.classList.add('active');
                    dot.addEventListener('click', () => goToSlide(i));
                    dotsContainer.appendChild(dot);
                }
                const dots = dotsContainer.querySelectorAll('.carousel-dot');


                /**
                 * Shows a specific slide (for a fade carousel).
                 * @param {number} index - Index of the slide to show.
                 */
                function showSlide(index) {
                    slides.forEach(slide => slide.classList.remove('active'));
                    slides[index].classList.add('active');
                    currentSlideIndex = index;
                    dots.forEach((dot, i) => {
                        if (i === index) {
                            dot.classList.add('active');
                        } else {
                            dot.classList.remove('active');
                        }
                    });
                }

                /**
                 * Starts the automatic slideshow.
                 */
                function startSlideShow() {
                    clearInterval(slideInterval);
                    slideInterval = setInterval(nextSlide, intervalTime);
                }

                /**
                 * Goes to the next slide.
                 */
                function nextSlide() {
                    currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                    showSlide(currentSlideIndex);
                }

                /**
                 * Goes to the previous slide.
                 */
                function prevSlide() {
                    currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
                    showSlide(currentSlideIndex);
                }

                /**
                 * Goes to a specific slide.
                 * @param {number} index - Index of the slide to go to.
                 */
                function goToSlide(index) {
                    clearInterval(slideInterval);
                    showSlide(index);
                    startSlideShow();
                }

                if (prevBtn) prevBtn.addEventListener('click', () => prevSlide());
                if (nextBtn) nextBtn.addEventListener('click', () => nextSlide());

                showSlide(currentSlideIndex);
                startSlideShow();
            }

            // Initialize the Hero Carousel
            initCarousel('hero-carousel', 'heroPrev', 'heroNext', 'heroDots', 7000, 'hero-slide', 'carousel-slides-container');
            // Initialize the Upcoming Sales Carousel
            initCarousel('upcomingSalesCarousel', 'upcomingSalesPrev', 'upcomingSalesNext', 'upcomingSalesDots', 8000, 'upcoming-sale-slide', 'carousel-slides-container');


            // ====================================================================================
            // === CART LOGIC =====================================================================
            // ====================================================================================

            const CART_STORAGE_KEY = 'asg_empire_cart';
            let cart = [];

            /**
             * Loads cart items from localStorage.
             */
            function loadCart() {
                try {
                    const storedCart = localStorage.getItem(CART_STORAGE_KEY);
                    cart = storedCart ? JSON.parse(storedCart) : [];
                    updateCartUI();
                } catch (e) {
                    console.error("Error loading cart from localStorage:", e);
                    cart = [];
                    updateCartUI();
                }
            }

            /**
             * Saves cart items to localStorage.
             */
            function saveCart() {
                try {
                    localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                    updateCartUI();
                }
                catch (e) {
                    console.error("Error saving cart to localStorage:", e);
                }
            }

            /**
             * Updates the cart user interface (item list, total, count).
             */
            function updateCartUI() {
                cartItemsContainer.innerHTML = '';
                let total = 0;
                let itemCount = 0;

                if (cart.length === 0) {
                    emptyCartMessage.classList.remove('hidden');
                    cartTotalContainer.classList.add('hidden');
                    checkoutBtn.classList.add('hidden');
                    clearCartBtn.classList.add('hidden');
                    cartCountElem.classList.add('hidden');
                } else {
                    emptyCartMessage.classList.add('hidden');
                    cartTotalContainer.classList.remove('hidden');
                    checkoutBtn.classList.remove('hidden');
                    clearCartBtn.classList.remove('hidden');
                    cartCountElem.classList.remove('hidden');

                    cart.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        total += itemTotal;
                        itemCount += item.quantity;

                        const cartItemDiv = document.createElement('div');
                        cartItemDiv.classList.add('cart-item');
                        cartItemDiv.innerHTML = `
                            <img src="${item.image}" alt="${item.name}" class="cart-item-image" loading="lazy">
                            <div class="cart-item-details">
                                <h4>${item.name}</h4>
                                <p>S/. ${item.price.toFixed(2)}</p>
                            </div>
                            <div class="cart-item-actions">
                                <button data-product-id="${item.id}" class="quantity-btn decrease-quantity-btn" aria-label="Disminuir cantidad de ${item.name}">-</button>
                                <input type="number" min="1" value="${item.quantity}" data-product-id="${item.id}" class="quantity-input" aria-label="Cantidad de ${item.name}">
                                <button data-product-id="${item.id}" class="quantity-btn increase-quantity-btn" aria-label="Aumentar cantidad de ${item.name}">+</button>
                                <button data-product-id="${item.id}" class="remove-from-cart-btn" aria-label="Eliminar ${item.name} del carrito">Eliminar</button>
                            </div>
                        `;
                        cartItemsContainer.appendChild(cartItemDiv);
                    });
                }

                cartTotalPriceElem.textContent = total.toFixed(2);
                cartCountElem.textContent = itemCount;

                document.querySelectorAll('.quantity-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const productId = e.target.dataset.productId;
                        const newQuantity = parseInt(e.target.value);
                        updateCartItemQuantity(productId, newQuantity);
                    });
                });
                document.querySelectorAll('.remove-from-cart-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId;
                        removeCartItem(productId);
                    });
                });
                document.querySelectorAll('.decrease-quantity-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId;
                        const quantityInput = cartItemsContainer.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        let currentQuantity = parseInt(quantityInput.value);
                        if (currentQuantity > 1) {
                            quantityInput.value = currentQuantity - 1;
                            updateCartItemQuantity(productId, currentQuantity - 1);
                        }
                    });
                });
                document.querySelectorAll('.increase-quantity-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId;
                        const quantityInput = cartItemsContainer.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        let currentQuantity = parseInt(quantityInput.value);
                        quantityInput.value = currentQuantity + 1;
                        updateCartItemQuantity(productId, currentQuantity + 1);
                    });
                });
            }

            /**
             * Adds a product to the cart or updates its quantity.
             * @param {string} id
             * @param {string} name
             * @param {number} price
             * @param {string} image
             * @param {number} quantity - Quantity to add.
             */
            function addToCart(id, name, price, image, quantity = 1) {
                const existingItem = cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cart.push({ id, name, price, image, quantity: quantity });
                }
                saveCart();
                itemAddedMessage.textContent = `"${name}" ha sido a√±adido a tu carrito.`;
                openModal(itemAddedModal);
            }

            /**
             * Updates the quantity of a product in the cart.
             * @param {string} id
             * @param {number} quantity
             */
            function updateCartItemQuantity(id, quantity) {
                const itemIndex = cart.findIndex(item => item.id === id);
                if (itemIndex !== -1) {
                    if (quantity > 0) {
                        cart[itemIndex].quantity = quantity;
                    } else {
                        cart.splice(itemIndex, 1);
                    }
                    saveCart();
                }
            }

            /**
             * Removes a product from the cart.
             * @param {string} id
             */
            function removeCartItem(id) {
                cart = cart.filter(item => item.id !== id);
                saveCart();
            }

            /**
             * Clears all items from the cart.
             */
            clearCartBtn.addEventListener('click', async () => {
                const confirmationModal = createConfirmationModal("¬øEst√°s seguro de que quieres vaciar tu carrito?", () => {
                    cart = [];
                    saveCart();
                    displayMessageModal("Tu carrito ha sido vaciado.");
                    closeModal(confirmationModal);
                });
                openModal(confirmationModal);
            });

            document.addEventListener('click', (e) => {
                const addToCartButton = e.target.closest('.add-to-cart-btn');
                if (addToCartButton) {
                    const productId = addToCartButton.dataset.productId;
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        addToCart(product.id, product.name, product.price, product.image);
                    }
                }
            });

            cartBtn.addEventListener('click', () => {
                updateCartUI();
                openModal(cartModal);
            });
            closeCartModalBtn.addEventListener('click', () => closeModal(cartModal));

            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    closeModal(cartModal);
                }
            });

            checkoutBtn.addEventListener('click', () => {
                if (cart.length === 0) {
                    displayMessageModal("Tu carrito est√° vac√≠o. A√±ade productos antes de proceder al pago.");
                    return;
                }
                closeModal(cartModal);
                populatePurchaseConfirmModal();
                openModal(purchaseConfirmModal);
            });

            /**
             * Populates the purchase confirmation modal with the cart summary.
             * @param {Object} [singleProduct=null] - A single product for direct purchase, if applicable.
             */
            function populatePurchaseConfirmModal(singleProduct = null) {
                confirmCartSummary.innerHTML = '';
                let itemsToConfirm = singleProduct ? [singleProduct] : cart;
                let total = 0;

                if (itemsToConfirm.length === 0) {
                    confirmCartSummary.innerHTML = '<li>No hay productos para confirmar.</li>';
                    confirmTotalPriceElem.textContent = '0.00';
                    return;
                }

                itemsToConfirm.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    const listItem = document.createElement('li');
                    listItem.textContent = `${item.name} (x${item.quantity}) - S/. ${(item.price * item.quantity).toFixed(2)}`;
                    confirmCartSummary.appendChild(listItem);
                });
                confirmTotalPriceElem.textContent = total.toFixed(2);
            }

            closePurchaseConfirmModalBtn.addEventListener('click', () => closeModal(purchaseConfirmModal));
            cancelPurchaseConfirmModalBtn.addEventListener('click', () => {
                closeModal(purchaseConfirmModal);
                openModal(cartModal);
            });

            purchaseConfirmModal.addEventListener('click', (e) => {
                if (e.target === purchaseConfirmModal) {
                    closeModal(purchaseConfirmModal);
                }
            });

            confirmEmailInput.addEventListener('input', () => {
                const email = confirmEmailInput.value;
                const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(?:\.[a-zA-Z]{2,})?$/;
                const allowedDomains = [
                    'gmail.com', 'hotmail.com', 'outlook.com', 'yahoo.com', 'aol.com',
                    'icloud.com', 'protonmail.com', 'zoho.com', 'yandex.com', 'gmx.com',
                    'mail.com', 'live.com', 'msn.com', 'googlemail.com', 'outlook.es',
                    'hotmail.es', 'yahoo.es', 'mail.es'
                ];

                const domain = email.substring(email.indexOf('@') + 1).toLowerCase();

                if (!emailPattern.test(email) || !allowedDomains.includes(domain)) {
                    emailErrorSpan.classList.remove('hidden');
                } else {
                    emailErrorSpan.classList.add('hidden');
                }
            });

            purchaseConfirmForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const email = confirmEmailInput.value;
                const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(?:\.[a-zA-Z]{2,})?$/;
                const allowedDomains = [
                    'gmail.com', 'hotmail.com', 'outlook.com', 'yahoo.com', 'aol.com',
                    'icloud.com', 'protonmail.com', 'zoho.com', 'yandex.com', 'gmx.com',
                    'mail.com', 'live.com', 'msn.com', 'googlemail.com', 'outlook.es',
                    'hotmail.es', 'yahoo.es', 'mail.es'
                ];
                const domain = email.substring(email.indexOf('@') + 1).toLowerCase();

                if (!emailPattern.test(email) || !allowedDomains.includes(domain)) {
                    emailErrorSpan.classList.remove('hidden');
                    displayMessageModal("Por favor, ingresa un correo electr√≥nico v√°lido con un dominio com√∫n (ej. @gmail.com, @hotmail.com, @outlook.com).", "Error de Validaci√≥n");
                    return;
                } else {
                    emailErrorSpan.classList.add('hidden');
                }

                const customerName = document.getElementById('confirmName').value;
                const customerEmail = document.getElementById('confirmEmail').value;
                const customerPhone = document.getElementById('confirmPhone').value;
                const customerAddress = document.getElementById('confirmAddress').value;
                const finalTotal = confirmTotalPriceElem.textContent;

                let whatsappMessage = `Hola ASG Empire, quisiera m√°s informaci√≥n de este pedido.\n\n`;
                whatsappMessage += `Mi informaci√≥n es:\n`;
                whatsappMessage += `Nombre: ${customerName}\n`;
                whatsappMessage += `Email: ${customerEmail}\n`;
                whatsappMessage += `Tel√©fono: ${customerPhone || 'No proporcionado'}\n`;
                whatsappMessage += `Direcci√≥n: ${customerAddress}\n\n`;
                whatsappMessage += `Detalles del Pedido:\n`;

                let itemsToConfirm = currentProduct ? [{ ...currentProduct, quantity: parseInt(productQuantityInput.value) }] : cart;

                itemsToConfirm.forEach(item => {
                    whatsappMessage += `- ${item.name} (x${item.quantity}) - S/. ${(item.price * item.quantity).toFixed(2)}\n`;
                });
                whatsappMessage += `\nTotal a Pagar: S/. ${finalTotal}\n`;

                const encodedMessage = encodeURIComponent(whatsappMessage);
                const whatsappUrl = `https://api.whatsapp.com/send?phone=+51952350539&text=${encodedMessage}`;

                window.location.href = whatsappUrl;

                cart = [];
                saveCart();
                closeModal(purchaseConfirmModal);
                purchaseConfirmForm.reset();
            });

            // ====================================================================================
            // === WISHLIST LOGIC =================================================================
            // ====================================================================================

            const WISHLIST_STORAGE_KEY = 'asg_empire_wishlist';
            let wishlist = [];
            let wishlistTimeout;

            /**
             * Loads wishlist items from localStorage.
             */
            function loadWishlist() {
                try {
                    const storedWishlist = localStorage.getItem(WISHLIST_STORAGE_KEY);
                    wishlist = storedWishlist ? JSON.parse(storedWishlist) : [];
                    updateWishlistIcons();
                    updateWishlistSidebarUI();
                } catch (e) {
                    console.error("Error loading wishlist from localStorage:", e);
                    wishlist = [];
                }
            }

            /**
             * Saves wishlist items to localStorage.
             */
            function saveWishlist() {
                try {
                    localStorage.setItem(WISHLIST_STORAGE_KEY, JSON.stringify(wishlist));
                    updateWishlistIcons();
                    updateWishlistModalUI();
                    updateWishlistSidebarUI();
                } catch (e) {
                    console.error("Error saving wishlist to localStorage:", e);
                }
            }

            /**
             * Toggles a product in the wishlist.
             * @param {string} productId
             * @param {HTMLElement} iconElement
             */
            function toggleWishlist(productId, iconElement) {
                const product = products.find(p => p.id === productId);
                if (!product) return;

                const existingItemIndex = wishlist.findIndex(item => item.id === productId);

                if (existingItemIndex !== -1) {
                    wishlist.splice(existingItemIndex, 1);
                    displayMessageModal(`"${product.name}" eliminado de tu lista de deseos.`);
                } else {
                    wishlist.push({ id: product.id, name: product.name, price: product.price, image: product.image });
                    displayMessageModal(`"${product.name}" a√±adido a tu lista de deseos.`);
                }
                saveWishlist();
                showWishlistSidebar();
                resetWishlistTimeout();
            }

            /**
             * Updates the visual state of wishlist icons on product cards.
             */
            function updateWishlistIcons() {
                const allWishlistIcons = document.querySelectorAll('.wishlist-icon');
                allWishlistIcons.forEach(icon => {
                    const productId = icon.dataset.productId;
                    if (wishlist.some(item => item.id === productId)) {
                        icon.classList.remove('far');
                        icon.classList.add('fas', 'active');
                    } else {
                        icon.classList.remove('fas', 'active');
                        icon.classList.add('far');
                    }
                });
            }

            /**
             * Removes a product from the wishlist.
             * @param {string} id
             */
            function removeWishlistItem(id) {
                wishlist = wishlist.filter(item => item.id !== id);
                saveWishlist();
                resetWishlistTimeout();
            }

            /**
             * Updates the wishlist modal UI.
             */
            function updateWishlistModalUI() {
                wishlistItemsContainer.innerHTML = '';
                if (wishlist.length === 0) {
                    emptyWishlistMessage.classList.remove('hidden');
                    clearWishlistBtn.classList.add('hidden');
                } else {
                    emptyWishlistMessage.classList.add('hidden');
                    clearWishlistBtn.classList.remove('hidden');
                    wishlist.forEach(item => {
                        const wishlistItemDiv = document.createElement('div');
                        wishlistItemDiv.classList.add('cart-item');
                        wishlistItemDiv.innerHTML = `
                            <img src="${item.image}" alt="${item.name}" class="cart-item-image" loading="lazy">
                            <div class="item-info">
                                <h4>${item.name}</h4>
                                <p>S/. ${item.price.toFixed(2)}</p>
                            </div>
                            <div class="cart-item-actions">
                                <button data-product-id="${item.id}" class="remove-from-wishlist-btn" aria-label="Eliminar ${item.name} de la lista de deseos">Eliminar</button>
                                <button data-product-id="${item.id}" class="add-to-cart-from-wishlist-btn btn btn-primary text-xs px-2 py-1" aria-label="A√±adir ${item.name} al carrito">A√±adir al Carrito</button>
                            </div>
                        `;
                        wishlistItemsContainer.appendChild(wishlistItemDiv);
                    });
                }

                document.querySelectorAll('.remove-from-wishlist-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId;
                        removeWishlistItem(productId);
                    });
                });
                document.querySelectorAll('.add-to-cart-from-wishlist-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId;
                        const product = products.find(p => p.id === productId);
                        if (product) {
                            addToCart(product.id, product.name, product.price, product.image);
                            removeWishlistItem(productId);
                        }
                    });
                });
            }

            /**
             * Updates the wishlist sidebar UI.
             */
            function updateWishlistSidebarUI() {
                wishlistSidebarItems.innerHTML = '';
                if (wishlist.length === 0) {
                    emptyWishlistSidebarMessage.classList.remove('hidden');
                    clearWishlistSidebarBtn.classList.add('hidden');
                    hideWishlistSidebar();
                } else {
                    emptyWishlistSidebarMessage.classList.add('hidden');
                    clearWishlistSidebarBtn.classList.remove('hidden');
                    if (window.innerWidth >= 768 && !wishlistSidebar.classList.contains('show-sidebar')) {
                        showWishlistSidebar();
                        resetWishlistTimeout();
                    }

                    wishlist.forEach(item => {
                        const wishlistItemDiv = document.createElement('div');
                        wishlistItemDiv.classList.add('wishlist-item-sidebar');
                        wishlistItemDiv.innerHTML = `
                            <img src="${item.image}" alt="${item.name}" loading="lazy">
                            <div class="item-info">
                                <h4>${item.name}</h4>
                                <p>S/. ${item.price.toFixed(2)}</p>
                            </div>
                            <div class="item-actions">
                                <button data-product-id="${item.id}" class="add-to-cart-from-wishlist-sidebar-btn btn btn-primary" aria-label="A√±adir ${item.name} al carrito">
                                    <i class="fas fa-cart-plus" aria-hidden="true"></i>
                                </button>
                                <button data-product-id="${item.id}" class="remove-from-wishlist-sidebar-btn btn btn-secondary" aria-label="Eliminar ${item.name} de la lista de deseos">
                                    <i class="fas fa-trash" aria-hidden="true"></i>
                                </button>
                            </div>
                        `;
                        wishlistSidebarItems.appendChild(wishlistItemDiv);
                    });
                }

                document.querySelectorAll('.remove-from-wishlist-sidebar-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId || e.target.closest('button').dataset.productId;
                        removeWishlistItem(productId);
                    });
                });
                document.querySelectorAll('.add-to-cart-from-wishlist-sidebar-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.target.dataset.productId || e.target.closest('button').dataset.productId;
                        const product = products.find(p => p.id === productId);
                        if (product) {
                            addToCart(product.id, product.name, product.price, product.image);
                            removeWishlistItem(productId);
                        }
                    });
                });
            }


            /**
             * Shows the wishlist sidebar.
             */
            function showWishlistSidebar() {
                if (window.innerWidth >= 768) {
                    wishlistSidebar.classList.add('show-sidebar');
                    mainContentContainer.classList.add('with-sidebar');
                    wishlistToggleButton.classList.add('shifted');
                    wishlistToggleButton.querySelector('i').classList.remove('fa-chevron-left');
                    wishlistToggleButton.querySelector('i').classList.add('fa-chevron-right');
                } else {
                    wishlistSidebar.classList.add('show-sidebar');
                }
            }

            /**
             * Hides the wishlist sidebar.
             */
            function hideWishlistSidebar() {
                if (window.innerWidth >= 768) {
                    wishlistSidebar.classList.remove('show-sidebar');
                    mainContentContainer.classList.remove('with-sidebar');
                    wishlistToggleButton.classList.remove('shifted');
                    wishlistToggleButton.querySelector('i').classList.remove('fa-chevron-right');
                    wishlistToggleButton.querySelector('i').classList.add('fa-chevron-left');
                } else {
                    wishlistSidebar.classList.remove('show-sidebar');
                }
            }

            /**
             * Resets the auto-close timer for the wishlist sidebar.
             */
            function resetWishlistTimeout() {
                clearTimeout(wishlistTimeout);
                if (wishlist.length > 0 && window.innerWidth >= 768) {
                    wishlistTimeout = setTimeout(hideWishlistSidebar, 5000);
                }
            }

            wishlistToggleButton.addEventListener('click', () => {
                if (wishlistSidebar.classList.contains('show-sidebar')) {
                    hideWishlistSidebar();
                } else {
                    showWishlistSidebar();
                    resetWishlistTimeout();
                }
            });

            document.addEventListener('click', (e) => {
                if (window.innerWidth >= 768 && wishlistSidebar.classList.contains('show-sidebar')) {
                    const isClickInsideSidebar = wishlistSidebar.contains(e.target) || wishlistToggleButton.contains(e.target);
                    if (!isClickInsideSidebar) {
                        hideWishlistSidebar();
                    }
                }
            });

            wishlistSidebar.addEventListener('mousemove', resetWishlistTimeout);
            wishlistSidebar.addEventListener('click', resetWishlistTimeout);


            /**
             * Clears all items from the wishlist.
             */
            clearWishlistBtn.addEventListener('click', () => {
                const confirmationModal = createConfirmationModal("¬øEst√°s seguro de que quieres vaciar tu lista de deseos?", () => {
                    wishlist = [];
                    saveWishlist();
                    displayMessageModal("Tu lista de deseos ha sido vaciada.");
                    closeModal(confirmationModal);
                });
                openModal(confirmationModal);
            });

            clearWishlistSidebarBtn.addEventListener('click', () => {
                const confirmationModal = createConfirmationModal("¬øEst√°s seguro de que quieres vaciar tu lista de deseos?", () => {
                    wishlist = [];
                    saveWishlist();
                    displayMessageModal("Tu lista de deseos ha sido vaciada.");
                    closeModal(confirmationModal);
                });
                openModal(confirmationModal);
            });


            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('wishlist-icon')) {
                    const productId = e.target.dataset.productId;
                    toggleWishlist(productId, e.target);
                }
            });


            closeWishlistModalBtn.addEventListener('click', () => closeModal(wishlistModal));

            wishlistModal.addEventListener('click', (e) => {
                if (e.target === wishlistModal) {
                    closeModal(wishlistModal);
                }
            });


            // ====================================================================================
            // === PRODUCT DETAIL MODAL LOGIC =====================================================
            // ====================================================================================

            let currentProduct = null;
            let productImageCarouselInstance = null;

            /**
             * Shows the product detail modal with the given product information.
             * @param {string} productId
             */
            function showProductDetail(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) {
                    console.error('Product not found:', productId);
                    return;
                }

                currentProduct = product;

                productDetailTitle.textContent = product.name;
                productDetailCurrentPrice.textContent = `S/. ${product.price.toFixed(2)}`;
                if (product.oldPrice) {
                    productDetailOldPrice.textContent = `S/. ${product.oldPrice.toFixed(2)}`;
                    productDetailOldPrice.classList.remove('hidden');
                } else {
                    productDetailOldPrice.classList.add('hidden');
                }
                if (product.discountPercentage) {
                    productDetailDiscountPercentage.textContent = `-${product.discountPercentage}% dto.`;
                    productDetailDiscountPercentage.classList.remove('hidden');
                } else {
                    productDetailDiscountPercentage.classList.add('hidden');
                }
                productDetailDescription.textContent = product.description;
                productQuantityInput.value = 1;

                const allProductImages = [product.image, ...product.galleryImages];
                const carouselSlidesContainer = document.querySelector('#productImageCarousel .carousel-slides-container');
                carouselSlidesContainer.innerHTML = '';

                allProductImages.forEach(imageUrl => {
                    const slideDiv = document.createElement('div');
                    slideDiv.classList.add('carousel-slide');
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = product.name;
                    img.loading = "lazy"; // Lazy load images
                    slideDiv.appendChild(img);
                    carouselSlidesContainer.appendChild(slideDiv);
                });

                // Reinitialize carousel if it already exists to update slides
                // This ensures the carousel re-renders with new images
                if (productImageCarouselInstance) {
                    clearInterval(productImageCarouselInstance.slideInterval); // Clear old interval if it exists
                }
                initCarousel('productImageCarousel', 'productImagePrev', 'productImageNext', 'productImageDots', 5000, 'carousel-slide', 'carousel-slides-container');


                productDetailSpecsList.innerHTML = '';
                product.specs.forEach(spec => {
                    const li = document.createElement('li');
                    li.innerHTML = `<i class="fas fa-check-circle" aria-hidden="true"></i> ${spec}`;
                    productDetailSpecsList.appendChild(li);
                });

                addToCartFromDetailBtn.onclick = () => {
                    const quantity = parseInt(productQuantityInput.value);
                    addToCart(product.id, product.name, product.price, product.image, quantity);
                    closeModal(productDetailModal);
                };
                buyNowBtn.onclick = () => {
                    closeModal(productDetailModal);
                    const quantity = parseInt(productQuantityInput.value);
                    populatePurchaseConfirmModal({ id: product.id, name: product.name, price: product.price, image: product.image, quantity: quantity });
                    openModal(purchaseConfirmModal);
                };

                openModal(productDetailModal);
            }

            decreaseQuantityBtn.addEventListener('click', () => {
                let currentQuantity = parseInt(productQuantityInput.value);
                if (currentQuantity > 1) {
                    productQuantityInput.value = currentQuantity - 1;
                }
            });

            increaseQuantityBtn.addEventListener('click', () => {
                let currentQuantity = parseInt(productQuantityInput.value);
                productQuantityInput.value = currentQuantity + 1;
            });

            productQuantityInput.addEventListener('change', () => {
                let currentQuantity = parseInt(productQuantityInput.value);
                if (currentQuantity < 1 || isNaN(currentQuantity)) {
                    productQuantityInput.value = 1;
                }
            });

            // Event listener for clicking anywhere on the product card (excluding specific elements)
            document.addEventListener('click', (e) => {
                const productCard = e.target.closest('.product-card');
                if (productCard) {
                    // Check if the click target is NOT the "Add to Cart" button or the wishlist icon
                    const isAddToCartBtn = e.target.classList.contains('add-to-cart-btn');
                    const isWishlistIcon = e.target.classList.contains('wishlist-icon');

                    if (!isAddToCartBtn && !isWishlistIcon) {
                        const productId = productCard.dataset.productId;
                        showProductDetail(productId);
                    }
                }
            });


            closeProductDetailModalBtn.addEventListener('click', () => {
                closeModal(productDetailModal);
            });

            productDetailModal.addEventListener('click', (e) => {
                if (e.target === productDetailModal) {
                    closeModal(productDetailModal);
                }
            });


            // ====================================================================================
            // === ORDER COMMENTS LOGIC (formerly Reviews) ========================================
            // ====================================================================================

            /**
             * Fetches and displays comments from Firestore.
             * Sets up a real-time listener using onSnapshot.
             */
            function fetchAndDisplayComments() {
                if (!isAuthReady) {
                    console.warn("Authentication not ready, cannot fetch comments yet.");
                    commentsList.innerHTML = `<p class="empty-cart-message">Cargando comentarios...</p>`;
                    return;
                }

                const commentsColRef = firebase.collection(db, `artifacts/${appId}/public/data/order_comments`);
                const q = firebase.query(commentsColRef);

                if (currentCommentsUnsubscribe) {
                    currentCommentsUnsubscribe();
                }

                currentCommentsUnsubscribe = firebase.onSnapshot(q, (snapshot) => {
                    const comments = [];
                    snapshot.forEach((doc) => {
                        const commentData = doc.data();
                        comments.push(commentData);
                    });

                    displayComments(comments);
                }, (error) => {
                    console.error("Error fetching comments:", error);
                    commentsList.innerHTML = `<p class="text-red-500">Error al cargar comentarios: ${error.message}</p>`;
                });
            }

            /**
             * Displays the list of comments.
             * @param {Array<Object>} comments - Array of comment objects.
             */
            function displayComments(comments) {
                commentsList.innerHTML = '';
                if (comments.length === 0) {
                    noCommentsMessage.classList.remove('hidden');
                } else {
                    noCommentsMessage.classList.add('hidden');
                    const sortedComments = [...comments].sort((a, b) => {
                        const timeA = a.timestamp ? a.timestamp.toDate().getTime() : 0;
                        const timeB = b.timestamp ? b.timestamp.toDate().getTime() : 0;
                        return timeB - timeA;
                    });

                    sortedComments.forEach(comment => {
                        const commentItem = document.createElement('div');
                        commentItem.classList.add('comment-item');
                        commentItem.innerHTML = `
                            <strong>${comment.name}</strong>
                            <p>${comment.comment}</p>
                        `;
                        commentsList.appendChild(commentItem);
                    });
                }
            }

            addCommentForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady) {
                    console.warn("Cannot add comment: authentication not ready.");
                    displayMessageModal('Error: No se puede a√±adir el comentario en este momento. Int√©ntalo de nuevo m√°s tarde.');
                    return;
                }

                const commenterName = commenterNameInput.value.trim();
                const commentText = commentTextInput.value.trim();

                if (commenterName && commentText) {
                    try {
                        const commentsColRef = firebase.collection(db, `artifacts/${appId}/public/data/order_comments`);
                        await firebase.addDoc(commentsColRef, {
                            name: commenterName,
                            comment: commentText,
                            userId: userId,
                            timestamp: firebase.serverTimestamp()
                        });

                        addCommentForm.reset();
                        displayMessageModal('¬°Gracias por tu comentario! Se ha enviado correctamente.');
                    } catch (error) {
                        console.error("Error adding comment:", error);
                        displayMessageModal(`Error al enviar el comentario: ${error.message}`);
                    }
                } else {
                    displayMessageModal('Por favor, completa todos los campos del comentario.');
                }
            });


            // ====================================================================================
            // === FAQ ACCORDION LOGIC ============================================================
            // ====================================================================================

            document.querySelectorAll('.faq-question').forEach(question => {
                question.addEventListener('click', () => {
                    const answer = question.nextElementSibling;
                    const icon = question.querySelector('.faq-toggle-icon');

                    // Close other open answers
                    document.querySelectorAll('.faq-answer.active').forEach(openAnswer => {
                        if (openAnswer !== answer) {
                            openAnswer.classList.remove('active');
                            openAnswer.previousElementSibling.querySelector('.faq-toggle-icon').classList.remove('rotated');
                            openAnswer.style.borderTop = 'none';
                            openAnswer.style.paddingTop = '0';
                            openAnswer.setAttribute('aria-hidden', 'true');
                            openAnswer.previousElementSibling.setAttribute('aria-expanded', 'false');
                        }
                    });

                    // Toggle current answer
                    const isActive = answer.classList.toggle('active');
                    icon.classList.toggle('rotated');
                    question.setAttribute('aria-expanded', isActive);
                    answer.setAttribute('aria-hidden', !isActive);


                    if (isActive) {
                        answer.style.borderTop = '1px dashed #4a5568';
                        answer.style.paddingTop = '0.8rem';
                    } else {
                        answer.style.borderTop = 'none';
                        answer.style.paddingTop = '0';
                    }
                });
            });

            // ====================================================================================
            // === BACK TO TOP BUTTON LOGIC =======================================================
            // ====================================================================================

            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });

            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            // ====================================================================================
            // === CUSTOM MODAL LOGIC (replacing alert/confirm) ==================================
            // ====================================================================================

            /**
             * Creates and displays a custom message modal.
             * @param {string} message - The message to display.
             * @param {string} [title="Informaci√≥n"] - The modal title.
             */
            function displayMessageModal(message, title = "Informaci√≥n") {
                let messageModal = document.getElementById('customMessageModal');
                if (!messageModal) {
                    messageModal = document.createElement('div');
                    messageModal.id = 'customMessageModal';
                    messageModal.classList.add('modal-overlay', 'hidden');
                    messageModal.innerHTML = `
                        <div class="modal-content" role="alertdialog" aria-labelledby="customMessageModalTitle" aria-describedby="customMessageModalDescription">
                            <button class="modal-close-btn" aria-label="Cerrar">&times;</button>
                            <h3 class="modal-title" id="customMessageModalTitle"></h3>
                            <p class="modal-description" id="customMessageModalDescription"></p>
                            <div class="modal-buttons justify-center">
                                <button class="btn btn-primary close-btn">Aceptar</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(messageModal);

                    messageModal.querySelector('.modal-close-btn').addEventListener('click', () => closeModal(messageModal));
                    messageModal.querySelector('.close-btn').addEventListener('click', () => closeModal(messageModal));
                    messageModal.addEventListener('click', (e) => {
                        if (e.target === messageModal) {
                            closeModal(messageModal);
                        }
                    });
                }
                messageModal.querySelector('.modal-title').textContent = title;
                messageModal.querySelector('.modal-description').textContent = message;
                openModal(messageModal);
            }

            /**
             * Creates and displays a custom confirmation modal.
             * @param {string} message - The confirmation message.
             * @param {Function} onConfirm - Function to execute if confirmed.
             * @param {string} [title="Confirmaci√≥n"] - The modal title.
             */
            function createConfirmationModal(message, onConfirm, title = "Confirmaci√≥n") {
                let confirmationModal = document.getElementById('customConfirmationModal');
                if (!confirmationModal) {
                    confirmationModal = document.createElement('div');
                    confirmationModal.id = 'customConfirmationModal';
                    confirmationModal.classList.add('modal-overlay', 'hidden');
                    confirmationModal.innerHTML = `
                        <div class="modal-content" role="alertdialog" aria-labelledby="customConfirmationModalTitle" aria-describedby="customConfirmationModalDescription">
                            <button class="modal-close-btn" aria-label="Cerrar">&times;</button>
                            <h3 class="modal-title" id="customConfirmationModalTitle"></h3>
                            <p class="modal-description" id="customConfirmationModalDescription"></p>
                            <div class="modal-buttons">
                                <button class="btn btn-primary confirm-btn">S√≠</button>
                                <button class="btn btn-secondary cancel-btn">No</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(confirmationModal);
                }

                confirmationModal.querySelector('.modal-title').textContent = title;
                confirmationModal.querySelector('.modal-description').textContent = message;

                const confirmBtn = confirmationModal.querySelector('.confirm-btn');
                const cancelBtn = confirmationModal.querySelector('.cancel-btn');
                const closeBtn = confirmationModal.querySelector('.modal-close-btn');

                confirmBtn.onclick = null;
                cancelBtn.onclick = null;
                closeBtn.onclick = null;

                confirmBtn.onclick = () => {
                    onConfirm();
                    closeModal(confirmationModal);
                };
                cancelBtn.onclick = () => closeModal(confirmationModal);
                closeBtn.onclick = () => closeModal(confirmationModal);

                confirmationModal.addEventListener('click', (e) => {
                        if (e.target === confirmationModal) {
                            closeModal(confirmationModal);
                        }
                    });

                return confirmationModal;
            }

            // ====================================================================================
            // === HEADER AND SEARCH LOGIC ========================================================
            // ====================================================================================

            // Logo click to refresh page
            headerLogo.addEventListener('click', (e) => {
                e.preventDefault();
                window.location.reload();
            });

            /**
             * Handles the product search functionality.
             */
            function handleProductSearch() {
                const query = searchInput.value.trim().toLowerCase();
                if (!query) {
                    displayMessageModal("Por favor, introduce un t√©rmino de b√∫squeda.", "B√∫squeda Vac√≠a");
                    return;
                }

                const foundProduct = products.find(p => p.name.toLowerCase().includes(query));

                if (foundProduct) {
                    showProductDetail(foundProduct.id);
                } else {
                    displayMessageModal(`No se encontraron productos que coincidan con "${query}". Por favor, intenta con otro t√©rmino.`, "Sin Resultados");
                }
            }

            searchBtn.addEventListener('click', handleProductSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleProductSearch();
                }
            });

            // ====================================================================================
            // === WELCOME MODAL LOGIC ============================================================
            // ====================================================================================

            enterSiteBtn.addEventListener('click', () => {
                closeModal(welcomeModal);
            });

            openModal(welcomeModal);


            // ====================================================================================
            // === PRODUCT CATEGORY SECTIONS LOGIC ================================================
            // ====================================================================================

            const categories = [
                "Electr√≥nica y dispositivos inteligentes",
                "Salud, bienestar y fitness",
                "Productos sostenibles y ecol√≥gicos",
                "Productos para mascotas",
                "Oficina en casa y productividad",
                "Moda personalizable y accesorios",
                "Cocina, hogar y hobbies",
                "Belleza y cuidado personal en tendencia"
            ];

            /**
             * Renders the category tabs and product sections.
             */
            function renderCategorySections() {
                categoryTabsContainer.innerHTML = '';
                categoryProductSectionsContainer.innerHTML = '';

                categories.forEach((category, index) => {
                    // Create category tab button
                    const tabButton = document.createElement('button');
                    tabButton.classList.add('category-tab-btn');
                    tabButton.textContent = category;
                    tabButton.dataset.category = category;
                    tabButton.setAttribute('role', 'tab');
                    tabButton.setAttribute('aria-controls', `category-${category.replace(/\s+/g, '-').toLowerCase()}`);
                    tabButton.setAttribute('id', `tab-${category.replace(/\s+/g, '-').toLowerCase()}`);

                    if (index === 0) { // Activate the first tab by default
                        tabButton.classList.add('active');
                        tabButton.setAttribute('aria-selected', 'true');
                        tabButton.setAttribute('tabindex', '0');
                    } else {
                        tabButton.setAttribute('aria-selected', 'false');
                        tabButton.setAttribute('tabindex', '-1');
                    }
                    tabButton.addEventListener('click', () => showCategory(category));
                    categoryTabsContainer.appendChild(tabButton);

                    // Create category product section
                    const categorySection = document.createElement('div');
                    categorySection.id = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;
                    categorySection.classList.add('category-product-section');
                    categorySection.setAttribute('role', 'tabpanel');
                    categorySection.setAttribute('aria-labelledby', `tab-${category.replace(/\s+/g, '-').toLowerCase()}`);
                    if (index === 0) { // Show the first section by default
                        categorySection.classList.add('active');
                        categorySection.setAttribute('aria-hidden', 'false');
                    } else {
                        categorySection.setAttribute('aria-hidden', 'true');
                    }

                    const productGrid = document.createElement('div');
                    productGrid.classList.add('category-product-grid');

                    const productsInCategory = products.filter(p => p.category === category);

                    if (productsInCategory.length === 0) {
                        productGrid.innerHTML = `<p class="text-center text-gray-400 col-span-full py-8">No hay productos en esta categor√≠a todav√≠a.</p>`;
                    } else {
                        productsInCategory.forEach(product => {
                            const productCardDiv = document.createElement('div');
                            productCardDiv.classList.add('product-card');
                            productCardDiv.dataset.productId = product.id; // Add product ID to the card for click event
                            productCardDiv.setAttribute('role', 'article');
                            productCardDiv.setAttribute('aria-labelledby', `product-title-${product.id}`);
                            productCardDiv.innerHTML = `
                                <div class="product-image-wrapper">
                                    <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                                    <i class="far fa-heart wishlist-icon" data-product-id="${product.id}" role="button" aria-label="A√±adir a la lista de deseos"></i>
                                </div>
                                <h3 class="product-title" id="product-title-${product.id}">${product.name}</h3>
                                <div class="product-price-container">
                                    <div class="product-price-info">
                                        <span class="product-current-price">S/. ${product.price.toFixed(2)}</span>
                                        ${product.oldPrice ? `<span class="product-old-price">S/. ${product.oldPrice.toFixed(2)}</span>` : ''}
                                        ${product.discountPercentage ? `<span class="product-discount-percentage">-${product.discountPercentage}% dto.</span>` : ''}
                                    </div>
                                    <span class="product-price-note">Precio mostrado antes de impuestos</span>
                                </div>
                                <p class="product-review-snippet">"¬°Excelente producto y entrega r√°pida!"</p>
                                <div class="product-actions-group">
                                    <button class="add-to-cart-btn btn btn-primary" data-product-id="${product.id}" aria-label="A√±adir ${product.name} al carrito">A√±adir al Carrito</button>
                                </div>
                            `;
                            productGrid.appendChild(productCardDiv);
                        });
                    }
                    categorySection.appendChild(productGrid);
                    categoryProductSectionsContainer.appendChild(categorySection);
                });
                updateWishlistIcons(); // Update wishlist icons after rendering products
            }

            /**
             * Shows the products for a specific category and hides others.
             * @param {string} categoryName - The name of the category to show.
             */
            function showCategory(categoryName) {
                // Deactivate all tabs
                document.querySelectorAll('.category-tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                    btn.setAttribute('tabindex', '-1');
                });

                // Hide all product sections
                document.querySelectorAll('.category-product-section').forEach(section => {
                    section.classList.remove('active');
                    section.setAttribute('aria-hidden', 'true');
                });

                // Activate the clicked tab
                const activeTab = document.querySelector(`.category-tab-btn[data-category="${categoryName}"]`);
                if (activeTab) {
                    activeTab.classList.add('active');
                    activeTab.setAttribute('aria-selected', 'true');
                    activeTab.setAttribute('tabindex', '0');
                }

                // Show the corresponding product section
                const targetSectionId = `category-${categoryName.replace(/\s+/g, '-').toLowerCase()}`;
                const targetSection = document.getElementById(targetSectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    targetSection.setAttribute('aria-hidden', 'false');
                }
            }

            // Initial render of category sections
            renderCategorySections();
            // Hide the old "Conseguir M√°s" button as it's no longer needed with categories
            if (getMoreProductsBtn) {
                getMoreProductsBtn.style.display = 'none';
            }
            // Remove the old product carousel container
            const productCarouselContainer = document.getElementById('productCarousel');
            if (productCarouselContainer) {
                productCarouselContainer.remove();
            }

            // Update the "All Products Modal" to show all products without categories initially
            // This modal will now just list all products, the category sections handle the primary display
            function populateAllProductsModal() {
                allProductsGrid.innerHTML = '';
                products.forEach(product => {
                    const productCardDiv = document.createElement('div');
                    productCardDiv.classList.add('product-card');
                    productCardDiv.dataset.productId = product.id; // Add product ID to the card for click event
                    productCardDiv.setAttribute('role', 'article');
                    productCardDiv.setAttribute('aria-labelledby', `product-title-${product.id}`);
                    productCardDiv.innerHTML = `
                        <div class="product-image-wrapper">
                            <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                            <i class="far fa-heart wishlist-icon" data-product-id="${product.id}" role="button" aria-label="A√±adir a la lista de deseos"></i>
                        </div>
                        <h3 class="product-title" id="product-title-${product.id}">${product.name}</h3>
                        <div class="product-price-container">
                            <div class="product-price-info">
                                <span class="product-current-price">S/. ${product.price.toFixed(2)}</span>
                                ${product.oldPrice ? `<span class="product-old-price">S/. ${product.oldPrice.toFixed(2)}</span>` : ''}
                                ${product.discountPercentage ? `<span class="product-discount-percentage">-${product.discountPercentage}% dto.</span>` : ''}
                            </div>
                            <span class="product-price-note">Precio mostrado antes de impuestos</span>
                        </div>
                        <p class="product-review-snippet">"¬°Excelente producto y entrega r√°pida!"</p>
                        <div class="product-actions-group">
                            <button class="add-to-cart-btn btn btn-primary" data-product-id="${product.id}" aria-label="A√±adir ${product.name} al carrito">A√±adir al Carrito</button>
                        </div>
                    `;
                    allProductsGrid.appendChild(productCardDiv);
                });
                updateWishlistIcons();
            }

            // Now, the "Conseguir M√°s" button will open the all products modal.
            // If the button was removed, we might need to add it back or change its purpose.
            // For now, I'll assume the user wants to keep the "Conseguir M√°s" button to show ALL products in a modal.
            // So, I'll make sure it's visible and linked to populateAllProductsModal.
            if (getMoreProductsBtn) {
                getMoreProductsBtn.style.display = 'block'; // Ensure it's visible
                getMoreProductsBtn.removeEventListener('click', () => { populateAllProductsModal(); openModal(allProductsModal); }); // Remove old listener if any
                getMoreProductsBtn.addEventListener('click', () => {
                    populateAllProductsModal();
                    openModal(allProductsModal);
                });
            }


            loadCart();
            loadWishlist();
        };
    </script>
</body>
</html>
